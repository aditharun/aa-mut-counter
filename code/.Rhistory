}
#for single total manuscripts only showing All (old harlan file)
#df <- lapply(1:n.sheets, function(x) get_jacc_data(x = x, file = file))
df <- lapply(1:n.sheets, function(x) get_jacc_data_multi(x = x, file = file))
library(tidyverse)
library(readxl)
#file <- "~/Downloads/yearlystats-jacc.xlsx"
file <- "~/Downloads/jacc-data.xlsx"
n.sheets <- length(excel_sheets(file))
#year, month (incl total), number, article type
get_jacc_data_multi <- function(x, file){
manuscript_submissions <- read_excel(path = file, sheet = x)
#All Paper, Original Research, Research Letters, (Reviews/Invited pieces)
#Only the first three matters, 2005+ has research letters
manuscript_submissions <- manuscript_submissions[manuscript_submissions$`All papers`=="Total Manuscripts" & !is.na(manuscript_submissions$`All papers`),]
manuscript_submissions <- manuscript_submissions %>% select_if(~ !all(is.na(.)))
manuscript_submissions <- manuscript_submissions %>% select(-1)
colnames(manuscript_submissions) <- c(month.name, "Total")
if (nrow(manuscript_submissions) > 2){
row <- ((read_excel(path = file, sheet = x)  %>% mutate(idx = 1:n()) %>%
filter(`All papers` == "Total Manuscripts") %>% tail(n = 1) %>% pull(idx) ) )
letter_data <- read_excel(path = file, sheet = x)[c(row-1, row), ]
letter_records <- letter_data %>% select(-1) %>% slice(1) %>% select_if(~ !all(is.na(.))) %>% unname() %>% unlist()
letter_values <- letter_data %>% select(-1) %>% slice(2) %>% select_if(~ !all(is.na(.))) %>% unname() %>% unlist()
if (setdiff(c(month.name, "Total"), letter_records) > 0){
letter_df <- rbind(data.frame(name = setdiff(c(month.name, "Total"), letter_records), value = 0), data.frame(name = letter_records, value = letter_values)) %>% mutate(type = "Letters")
} else{
letter_df <- data.frame(name = letter_records, value = letter_values) %>% mutate(type = "Letters")
}
manuscript_submissions <- manuscript_submissions[1:2,]
}
manuscript_submissions$type <- c("All", "Original")
year <- excel_sheets(file)[x]
data <- manuscript_submissions %>% pivot_longer(-type)
df <- rbind(data, letter_df) %>% as_tibble()
data <- data %>% mutate(year = as.numeric(year))
return(data)
}
get_jacc_data <- function(x, file){
manuscript_submissions <- read_excel(path = file, sheet = x) %>% filter(...1 == "Total Manuscripts") %>% select(-1) %>% unname() %>% unlist() %>% na.omit() %>% as.numeric()
print(length(manuscript_submissions)) #should be 13
entries <- c(month.name, "Total")
year <- excel_sheets(file)[x]
data <- data.frame(year = rep(year, length(entries)), name = entries, value = manuscript_submissions)
return(data)
}
#for single total manuscripts only showing All (old harlan file)
#df <- lapply(1:n.sheets, function(x) get_jacc_data(x = x, file = file))
df <- lapply(1:n.sheets, function(x) get_jacc_data_multi(x = x, file = file))
file <- "~/Downloads/jacc-data.xlsx"
n.sheets <- length(excel_sheets(file))
#year, month (incl total), number, article type
get_jacc_data_multi <- function(x, file){
manuscript_submissions <- read_excel(path = file, sheet = x)
#All Paper, Original Research, Research Letters, (Reviews/Invited pieces)
#Only the first three matters, 2005+ has research letters
manuscript_submissions <- manuscript_submissions[manuscript_submissions$`All papers`=="Total Manuscripts" & !is.na(manuscript_submissions$`All papers`),]
manuscript_submissions <- manuscript_submissions %>% select_if(~ !all(is.na(.)))
manuscript_submissions <- manuscript_submissions %>% select(-1)
colnames(manuscript_submissions) <- c(month.name, "Total")
if (nrow(manuscript_submissions) > 2){
row <- ((read_excel(path = file, sheet = x)  %>% mutate(idx = 1:n()) %>%
filter(`All papers` == "Total Manuscripts") %>% tail(n = 1) %>% pull(idx) ) )
letter_data <- read_excel(path = file, sheet = x)[c(row-1, row), ]
letter_records <- letter_data %>% select(-1) %>% slice(1) %>% select_if(~ !all(is.na(.))) %>% unname() %>% unlist()
letter_values <- letter_data %>% select(-1) %>% slice(2) %>% select_if(~ !all(is.na(.))) %>% unname() %>% unlist()
if (length(setdiff(c(month.name, "Total"), letter_records)) > 0){
print(setdiff(c(month.name, "Total"), letter_records))
letter_df <- rbind(data.frame(name = setdiff(c(month.name, "Total"), letter_records), value = 0), data.frame(name = letter_records, value = letter_values)) %>% mutate(type = "Letters")
} else{
letter_df <- data.frame(name = letter_records, value = letter_values) %>% mutate(type = "Letters")
}
manuscript_submissions <- manuscript_submissions[1:2,]
}
manuscript_submissions$type <- c("All", "Original")
year <- excel_sheets(file)[x]
data <- manuscript_submissions %>% pivot_longer(-type)
df <- rbind(data, letter_df) %>% as_tibble()
data <- data %>% mutate(year = as.numeric(year))
return(data)
}
get_jacc_data <- function(x, file){
manuscript_submissions <- read_excel(path = file, sheet = x) %>% filter(...1 == "Total Manuscripts") %>% select(-1) %>% unname() %>% unlist() %>% na.omit() %>% as.numeric()
print(length(manuscript_submissions)) #should be 13
entries <- c(month.name, "Total")
year <- excel_sheets(file)[x]
data <- data.frame(year = rep(year, length(entries)), name = entries, value = manuscript_submissions)
return(data)
}
#for single total manuscripts only showing All (old harlan file)
#df <- lapply(1:n.sheets, function(x) get_jacc_data(x = x, file = file))
df <- lapply(1:n.sheets, function(x) get_jacc_data_multi(x = x, file = file))
df <- do.call(rbind, df)
df <- df %>% as_tibble() %>% type.convert(as.is = TRUE)
df2 <- df %>% filter(year < 2024)
settype <- "Letters"
df <- df2 %>% filter(type == settype)
yearlabel <- excel_sheets(file) %>% as.numeric() %>% range()
yearlytrend_fig <- df %>% filter(name == "Total") %>% ggplot(aes(x=year, y = value)) + geom_point(size = 3.5, color = "grey30") + geom_line(size = 0.75, color = "grey40") + theme_minimal() + scale_y_continuous(breaks = scales::pretty_breaks(n = 10)) + scale_x_continuous(breaks = seq(yearlabel[1], yearlabel[2], 1)) + theme(panel.border = element_rect(color = "black", fill = "transparent"), panel.grid = element_blank(), axis.ticks = element_line(color = "black"), axis.text = element_text(size = 12), axis.title = element_text(size = 15), axis.text.x = element_text(angle = 0, hjust = 0.5, size = 10)) + xlab("Year") + ylab(paste0(settype, " Submissions to JACC"))
#limits = c(3000, 7000)
month_names <- month.name
month_numeric <- match(month_names, month.name)
month_named_vector <- setNames(month_numeric, month_names)
m.df <- df %>% filter(name != "Total") %>% mutate(name = factor(name, levels = month.name)) %>% arrange(year) %>% mutate(label = paste0(name, year))
m.df$month_num <- month_named_vector[m.df$name] %>% unname()
m.df$label <- factor(m.df$label, levels = m.df$label)
m.df$year <- factor(m.df$year, levels = seq(2002, 2023, 1))
m.df$idx <- 1
monthtrend_fig <- (m.df %>% ggplot(aes(x=label, y=value, color = year, group = idx)) + geom_point(size = 2.75) + geom_line(size = 0.6, color = "grey80", alpha = 0.7) + theme_minimal() + theme(panel.border = element_rect(color = "black", fill = "transparent"), panel.grid = element_blank(), axis.ticks = element_line(color = "black")) + scale_color_manual(values = rep(c("navy", "navy"), 11)) + theme(legend.position = "none") + xlab("Months (2002 - 2023)") + ylab(paste0(settype, " Submissions to JACC")) + theme(axis.text = element_text(size = 14), axis.title = element_text(size = 16)) + scale_y_continuous(breaks = scales::pretty_breaks(n = 10))  + scale_x_discrete(breaks = m.df$label[seq(1, nrow(m.df), by = 12)], labels = unique(m.df$year), expand = c(0.05, 0)) )
df2
settype <- "Letters"
df <- df2 %>% filter(type == settype)
yearlabel <- excel_sheets(file) %>% as.numeric() %>% range()
yearlytrend_fig <- df %>% filter(name == "Total") %>% ggplot(aes(x=year, y = value)) + geom_point(size = 3.5, color = "grey30") + geom_line(size = 0.75, color = "grey40") + theme_minimal() + scale_y_continuous(breaks = scales::pretty_breaks(n = 10)) + scale_x_continuous(breaks = seq(yearlabel[1], yearlabel[2], 1)) + theme(panel.border = element_rect(color = "black", fill = "transparent"), panel.grid = element_blank(), axis.ticks = element_line(color = "black"), axis.text = element_text(size = 12), axis.title = element_text(size = 15), axis.text.x = element_text(angle = 0, hjust = 0.5, size = 10)) + xlab("Year") + ylab(paste0(settype, " Submissions to JACC"))
yearlytrend_fig
df
library(tidyverse)
library(readxl)
#file <- "~/Downloads/yearlystats-jacc.xlsx"
file <- "~/Downloads/jacc-data.xlsx"
n.sheets <- length(excel_sheets(file))
#year, month (incl total), number, article type
get_jacc_data_multi <- function(x, file){
manuscript_submissions <- read_excel(path = file, sheet = x)
#All Paper, Original Research, Research Letters, (Reviews/Invited pieces)
#Only the first three matters, 2005+ has research letters
manuscript_submissions <- manuscript_submissions[manuscript_submissions$`All papers`=="Total Manuscripts" & !is.na(manuscript_submissions$`All papers`),]
manuscript_submissions <- manuscript_submissions %>% select_if(~ !all(is.na(.)))
manuscript_submissions <- manuscript_submissions %>% select(-1)
colnames(manuscript_submissions) <- c(month.name, "Total")
if (nrow(manuscript_submissions) > 2){
row <- ((read_excel(path = file, sheet = x)  %>% mutate(idx = 1:n()) %>%
filter(`All papers` == "Total Manuscripts") %>% tail(n = 1) %>% pull(idx) ) )
letter_data <- read_excel(path = file, sheet = x)[c(row-1, row), ]
letter_records <- letter_data %>% select(-1) %>% slice(1) %>% select_if(~ !all(is.na(.))) %>% unname() %>% unlist()
letter_values <- letter_data %>% select(-1) %>% slice(2) %>% select_if(~ !all(is.na(.))) %>% unname() %>% unlist()
if (length(setdiff(c(month.name, "Total"), letter_records)) > 0){
print(setdiff(c(month.name, "Total"), letter_records))
letter_df <- rbind(data.frame(name = setdiff(c(month.name, "Total"), letter_records), value = 0), data.frame(name = letter_records, value = letter_values)) %>% mutate(type = "Letters")
} else{
letter_df <- data.frame(name = letter_records, value = letter_values) %>% mutate(type = "Letters")
}
manuscript_submissions <- manuscript_submissions[1:2,]
manuscript_submissions$type <- c("All", "Original")
year <- excel_sheets(file)[x]
data <- manuscript_submissions %>% pivot_longer(-type)
data <- rbind(data, letter_df) %>% as_tibble()
data <- data %>% mutate(year = as.numeric(year))
}
manuscript_submissions$type <- c("All", "Original")
year <- excel_sheets(file)[x]
data <- manuscript_submissions %>% pivot_longer(-type)
data <- data %>% mutate(year = as.numeric(year))
return(data)
}
get_jacc_data <- function(x, file){
manuscript_submissions <- read_excel(path = file, sheet = x) %>% filter(...1 == "Total Manuscripts") %>% select(-1) %>% unname() %>% unlist() %>% na.omit() %>% as.numeric()
print(length(manuscript_submissions)) #should be 13
entries <- c(month.name, "Total")
year <- excel_sheets(file)[x]
data <- data.frame(year = rep(year, length(entries)), name = entries, value = manuscript_submissions)
return(data)
}
#for single total manuscripts only showing All (old harlan file)
#df <- lapply(1:n.sheets, function(x) get_jacc_data(x = x, file = file))
df <- lapply(1:n.sheets, function(x) get_jacc_data_multi(x = x, file = file))
df <- do.call(rbind, df)
df <- df %>% as_tibble() %>% type.convert(as.is = TRUE)
df2 <- df %>% filter(year < 2024)
settype <- "Letters"
df <- df2 %>% filter(type == settype)
yearlabel <- excel_sheets(file) %>% as.numeric() %>% range()
yearlytrend_fig <- df %>% filter(name == "Total") %>% ggplot(aes(x=year, y = value)) + geom_point(size = 3.5, color = "grey30") + geom_line(size = 0.75, color = "grey40") + theme_minimal() + scale_y_continuous(breaks = scales::pretty_breaks(n = 10)) + scale_x_continuous(breaks = seq(yearlabel[1], yearlabel[2], 1)) + theme(panel.border = element_rect(color = "black", fill = "transparent"), panel.grid = element_blank(), axis.ticks = element_line(color = "black"), axis.text = element_text(size = 12), axis.title = element_text(size = 15), axis.text.x = element_text(angle = 0, hjust = 0.5, size = 10)) + xlab("Year") + ylab(paste0(settype, " Submissions to JACC"))
#limits = c(3000, 7000)
month_names <- month.name
month_numeric <- match(month_names, month.name)
month_named_vector <- setNames(month_numeric, month_names)
m.df <- df %>% filter(name != "Total") %>% mutate(name = factor(name, levels = month.name)) %>% arrange(year) %>% mutate(label = paste0(name, year))
m.df$month_num <- month_named_vector[m.df$name] %>% unname()
m.df$label <- factor(m.df$label, levels = m.df$label)
m.df$year <- factor(m.df$year, levels = seq(2002, 2023, 1))
m.df$idx <- 1
monthtrend_fig <- (m.df %>% ggplot(aes(x=label, y=value, color = year, group = idx)) + geom_point(size = 2.75) + geom_line(size = 0.6, color = "grey80", alpha = 0.7) + theme_minimal() + theme(panel.border = element_rect(color = "black", fill = "transparent"), panel.grid = element_blank(), axis.ticks = element_line(color = "black")) + scale_color_manual(values = rep(c("navy", "navy"), 11)) + theme(legend.position = "none") + xlab("Months (2002 - 2023)") + ylab(paste0(settype, " Submissions to JACC")) + theme(axis.text = element_text(size = 14), axis.title = element_text(size = 16)) + scale_y_continuous(breaks = scales::pretty_breaks(n = 10))  + scale_x_discrete(breaks = m.df$label[seq(1, nrow(m.df), by = 12)], labels = unique(m.df$year), expand = c(0.05, 0)) )
yearlytrend_fig
df
get_jacc_data(x =1, file = file)
get_jacc_data_multi(x =1, file = file)
get_jacc_data_multi(x =1, file = file) %>% filter(type == "Letters")
get_jacc_data_multi(x =1, file = file) %>% filter(type == "Letter")
get_jacc_data_multi <- function(x, file){
manuscript_submissions <- read_excel(path = file, sheet = x)
#All Paper, Original Research, Research Letters, (Reviews/Invited pieces)
#Only the first three matters, 2005+ has research letters
manuscript_submissions <- manuscript_submissions[manuscript_submissions$`All papers`=="Total Manuscripts" & !is.na(manuscript_submissions$`All papers`),]
manuscript_submissions <- manuscript_submissions %>% select_if(~ !all(is.na(.)))
manuscript_submissions <- manuscript_submissions %>% select(-1)
colnames(manuscript_submissions) <- c(month.name, "Total")
if (nrow(manuscript_submissions) > 2){
row <- ((read_excel(path = file, sheet = x)  %>% mutate(idx = 1:n()) %>%
filter(`All papers` == "Total Manuscripts") %>% tail(n = 1) %>% pull(idx) ) )
letter_data <- read_excel(path = file, sheet = x)[c(row-1, row), ]
letter_records <- letter_data %>% select(-1) %>% slice(1) %>% select_if(~ !all(is.na(.))) %>% unname() %>% unlist()
letter_values <- letter_data %>% select(-1) %>% slice(2) %>% select_if(~ !all(is.na(.))) %>% unname() %>% unlist()
if (length(setdiff(c(month.name, "Total"), letter_records)) > 0){
print(setdiff(c(month.name, "Total"), letter_records))
letter_df <- rbind(data.frame(name = setdiff(c(month.name, "Total"), letter_records), value = 0), data.frame(name = letter_records, value = letter_values)) %>% mutate(type = "Letters")
} else{
letter_df <- data.frame(name = letter_records, value = letter_values) %>% mutate(type = "Letters")
}
manuscript_submissions <- manuscript_submissions[1:2,]
manuscript_submissions$type <- c("All", "Original")
year <- excel_sheets(file)[x]
data <- manuscript_submissions %>% pivot_longer(-type)
data <- rbind(data, letter_df) %>% as_tibble()
data <- data %>% mutate(year = as.numeric(year))
} else{
manuscript_submissions$type <- c("All", "Original")
year <- excel_sheets(file)[x]
data <- manuscript_submissions %>% pivot_longer(-type)
data <- data %>% mutate(year = as.numeric(year))
}
return(data)
}
get_jacc_data_multi(x =1, file = file) %>% filter(type == "Letter")
x <- 5
manuscript_submissions <- read_excel(path = file, sheet = x)
#All Paper, Original Research, Research Letters, (Reviews/Invited pieces)
#Only the first three matters, 2005+ has research letters
manuscript_submissions <- manuscript_submissions[manuscript_submissions$`All papers`=="Total Manuscripts" & !is.na(manuscript_submissions$`All papers`),]
manuscript_submissions <- manuscript_submissions %>% select_if(~ !all(is.na(.)))
manuscript_submissions <- manuscript_submissions %>% select(-1)
colnames(manuscript_submissions) <- c(month.name, "Total")
manuscript_submissions
nrow(manuscript_submissions) > 2
row <- ((read_excel(path = file, sheet = x)  %>% mutate(idx = 1:n()) %>%
filter(`All papers` == "Total Manuscripts") %>% tail(n = 1) %>% pull(idx) ) )
letter_data <- read_excel(path = file, sheet = x)[c(row-1, row), ]
letter_records <- letter_data %>% select(-1) %>% slice(1) %>% select_if(~ !all(is.na(.))) %>% unname() %>% unlist()
letter_values <- letter_data %>% select(-1) %>% slice(2) %>% select_if(~ !all(is.na(.))) %>% unname() %>% unlist()
length(setdiff(c(month.name, "Total"), letter_records))
print(setdiff(c(month.name, "Total"), letter_records))
letter_df <- rbind(data.frame(name = setdiff(c(month.name, "Total"), letter_records), value = 0), data.frame(name = letter_records, value = letter_values)) %>% mutate(type = "Letters")
letter_df
manuscript_submissions <- manuscript_submissions[1:2,]
manuscript_submissions$type <- c("All", "Original")
manuscript_submissions
year <- excel_sheets(file)[x]
data <- manuscript_submissions %>% pivot_longer(-type)
data
rbind(data, letter_df) %>% as_tibble()
rbind(data, letter_df) %>% as_tibble() %>% filter(name == "Letter")
rbind(data, letter_df) %>% as_tibble() %>% filter(name == "Letters")
rbind(data, letter_df) %>% as_tibble() %>% filter(type == "Letters")
get_jacc_data_multi <- function(x, file){
manuscript_submissions <- read_excel(path = file, sheet = x)
#All Paper, Original Research, Research Letters, (Reviews/Invited pieces)
#Only the first three matters, 2005+ has research letters
manuscript_submissions <- manuscript_submissions[manuscript_submissions$`All papers`=="Total Manuscripts" & !is.na(manuscript_submissions$`All papers`),]
manuscript_submissions <- manuscript_submissions %>% select_if(~ !all(is.na(.)))
manuscript_submissions <- manuscript_submissions %>% select(-1)
colnames(manuscript_submissions) <- c(month.name, "Total")
if (nrow(manuscript_submissions) > 2){
row <- ((read_excel(path = file, sheet = x)  %>% mutate(idx = 1:n()) %>%
filter(`All papers` == "Total Manuscripts") %>% tail(n = 1) %>% pull(idx) ) )
letter_data <- read_excel(path = file, sheet = x)[c(row-1, row), ]
letter_records <- letter_data %>% select(-1) %>% slice(1) %>% select_if(~ !all(is.na(.))) %>% unname() %>% unlist()
letter_values <- letter_data %>% select(-1) %>% slice(2) %>% select_if(~ !all(is.na(.))) %>% unname() %>% unlist()
if (length(setdiff(c(month.name, "Total"), letter_records)) > 0){
print(setdiff(c(month.name, "Total"), letter_records))
letter_df <- rbind(data.frame(name = setdiff(c(month.name, "Total"), letter_records), value = 0), data.frame(name = letter_records, value = letter_values)) %>% mutate(type = "Letters")
} else{
letter_df <- data.frame(name = letter_records, value = letter_values) %>% mutate(type = "Letters")
}
manuscript_submissions <- manuscript_submissions[1:2,]
manuscript_submissions$type <- c("All", "Original")
year <- excel_sheets(file)[x]
data <- manuscript_submissions %>% pivot_longer(-type)
data <- rbind(data, letter_df) %>% as_tibble()
data <- data %>% mutate(year = as.numeric(year))
} else{
manuscript_submissions$type <- c("All", "Original")
year <- excel_sheets(file)[x]
data <- manuscript_submissions %>% pivot_longer(-type)
data <- data %>% mutate(year = as.numeric(year))
}
return(data)
}
get_jacc_data(x = x, file = file) %>% filter(type == "Letters")
get_jacc_data_multi(x = x, file = file) %>% filter(type == "Letters")
get_jacc_data_multi <- function(x, file){
manuscript_submissions <- read_excel(path = file, sheet = x)
#All Paper, Original Research, Research Letters, (Reviews/Invited pieces)
#Only the first three matters, 2005+ has research letters
manuscript_submissions <- manuscript_submissions[manuscript_submissions$`All papers`=="Total Manuscripts" & !is.na(manuscript_submissions$`All papers`),]
manuscript_submissions <- manuscript_submissions %>% select_if(~ !all(is.na(.)))
manuscript_submissions <- manuscript_submissions %>% select(-1)
colnames(manuscript_submissions) <- c(month.name, "Total")
if (nrow(manuscript_submissions) > 2){
row <- ((read_excel(path = file, sheet = x)  %>% mutate(idx = 1:n()) %>%
filter(`All papers` == "Total Manuscripts") %>% tail(n = 1) %>% pull(idx) ) )
letter_data <- read_excel(path = file, sheet = x)[c(row-1, row), ]
letter_records <- letter_data %>% select(-1) %>% slice(1) %>% select_if(~ !all(is.na(.))) %>% unname() %>% unlist()
letter_values <- letter_data %>% select(-1) %>% slice(2) %>% select_if(~ !all(is.na(.))) %>% unname() %>% unlist()
if (length(setdiff(c(month.name, "Total"), letter_records)) > 0){
print(setdiff(c(month.name, "Total"), letter_records))
letter_df <- rbind(data.frame(name = setdiff(c(month.name, "Total"), letter_records), value = 0), data.frame(name = letter_records, value = letter_values)) %>% mutate(type = "Letters")
} else{
letter_df <- data.frame(name = letter_records, value = letter_values) %>% mutate(type = "Letters")
}
manuscript_submissions <- manuscript_submissions[1:2,]
manuscript_submissions$type <- c("All", "Original")
year <- excel_sheets(file)[x]
data <- manuscript_submissions %>% pivot_longer(-type)
data <- rbind(data, letter_df) %>% as_tibble()
data <- data %>% mutate(year = as.numeric(year))
} else{
manuscript_submissions$type <- c("All", "Original")
year <- excel_sheets(file)[x]
data <- manuscript_submissions %>% pivot_longer(-type)
data <- data %>% mutate(year = as.numeric(year))
}
return(data)
}
get_jacc_data <- function(x, file){
manuscript_submissions <- read_excel(path = file, sheet = x) %>% filter(...1 == "Total Manuscripts") %>% select(-1) %>% unname() %>% unlist() %>% na.omit() %>% as.numeric()
print(length(manuscript_submissions)) #should be 13
entries <- c(month.name, "Total")
year <- excel_sheets(file)[x]
data <- data.frame(year = rep(year, length(entries)), name = entries, value = manuscript_submissions)
return(data)
}
#for single total manuscripts only showing All (old harlan file)
#df <- lapply(1:n.sheets, function(x) get_jacc_data(x = x, file = file))
df <- lapply(1:n.sheets, function(x) get_jacc_data_multi(x = x, file = file))
df
df <- do.call(rbind, df)
df <- df %>% as_tibble() %>% type.convert(as.is = TRUE)
df2 <- df %>% filter(year < 2024)
df2 %>% filter(type == "Letters")
settype <- "Letters"
df <- df2 %>% filter(type == settype)
yearlabel <- excel_sheets(file) %>% as.numeric() %>% range()
yearlytrend_fig <- df %>% filter(name == "Total") %>% ggplot(aes(x=year, y = value)) + geom_point(size = 3.5, color = "grey30") + geom_line(size = 0.75, color = "grey40") + theme_minimal() + scale_y_continuous(breaks = scales::pretty_breaks(n = 10)) + scale_x_continuous(breaks = seq(yearlabel[1], yearlabel[2], 1)) + theme(panel.border = element_rect(color = "black", fill = "transparent"), panel.grid = element_blank(), axis.ticks = element_line(color = "black"), axis.text = element_text(size = 12), axis.title = element_text(size = 15), axis.text.x = element_text(angle = 0, hjust = 0.5, size = 10)) + xlab("Year") + ylab(paste0(settype, " Submissions to JACC"))
yearlytrend_fig
month_names <- month.name
month_numeric <- match(month_names, month.name)
month_named_vector <- setNames(month_numeric, month_names)
m.df <- df %>% filter(name != "Total") %>% mutate(name = factor(name, levels = month.name)) %>% arrange(year) %>% mutate(label = paste0(name, year))
m.df$month_num <- month_named_vector[m.df$name] %>% unname()
m.df$label <- factor(m.df$label, levels = m.df$label)
m.df$year <- factor(m.df$year, levels = seq(2002, 2023, 1))
m.df$idx <- 1
monthtrend_fig <- (m.df %>% ggplot(aes(x=label, y=value, color = year, group = idx)) + geom_point(size = 2.75) + geom_line(size = 0.6, color = "grey80", alpha = 0.7) + theme_minimal() + theme(panel.border = element_rect(color = "black", fill = "transparent"), panel.grid = element_blank(), axis.ticks = element_line(color = "black")) + scale_color_manual(values = rep(c("navy", "navy"), 11)) + theme(legend.position = "none") + xlab("Months (2002 - 2023)") + ylab(paste0(settype, " Submissions to JACC")) + theme(axis.text = element_text(size = 14), axis.title = element_text(size = 16)) + scale_y_continuous(breaks = scales::pretty_breaks(n = 10))  + scale_x_discrete(breaks = m.df$label[seq(1, nrow(m.df), by = 12)], labels = unique(m.df$year), expand = c(0.05, 0)) )
cowplot::plot_grid(yearlytrend_fig, monthtrend_fig, rel_widths = c(1, 1.3)) %>% ggsave(filename = paste0("~/Downloads/JACC-", settype ,".pdf"), plot = ., units = "in", height = 9, width = 24, device = cairo_pdf)
install.packages("foreign")
library(foreign)
data <- read.xport("~/Downloads/SSCHL_A.XPT")
data
data %>% as_tibble()
library(tidyverse)
data %>% as_tibble()
install.packages("nhanesA")
library(nhanesA)
nhanesTables('LAB', 2020)
nhanesTables('LAB', 2019)
nhanesTables('LAB', 2018)
nhanesTables('LAB', 1998)
nhanesTables('LAB', 1999)
nhanesTables('LAB', 2004)
nhanesTables('DEMO', 2004)
nhanesTableVars('DEMO_C')
nhanesTableVars('DEMO', 'DEMO_C')
nhanesTables('Q', 2004)
nhanesTableVars('Q', 'HSQ_C')
nhanesTableVars('Q', 'CDQ_C')
nhanesTableVars('Q', 'HSQ_C')
(nhanesTableVars('Q', 'HSQ_C'))$Variable.Description[2]
nhanesTables('Q', 2004)
nhanesTables('EXAM', 2004)
nhanesTableVars('EXAM', 'BMX_C')
nhanesTables('EXAM', 2004)
nhanesTableVars('EXAM', 'BIX_C')
nhanesTableVars('EXAM', 'CVX_C')
nhanesTables('EXAM', 2004)
nhanesTableVars('EXAM', 'BPX_C')
nhanesTables('Q', 2004)
nhanesTables('Q', 2004)
nhanesTableVars('Q', 'HSQ_C')
nhanesTableVars('Q', 'SXQ_C')
nhanesTableVars('Q', 'SXQ_C')
nhanesTables('Q', 2004)
nhanesTableVars('Q', 'WHQ_C')
nhanesTables('Q', 2004)
nhanesTableVars('Q', 'PAQ_C')
nhanesTableVars('Q', 'PFQ_C')
nhanesTables('Q', 2004)
nhanesTableVars('Q', 'CIQGAD_C')
nhanesTableVars('Q', 'RXQ_RX_C')
nhanesTables('LAB', 2004)
nhanesTables('LAB', 2000)
nhanes("SSCHL_A")
x <- nhanes("SSCHL_A")
x %>% tail()
nhanesTables('LAB', 2000)
nhanesTables('LAB', 1999)
nhanesTables('LAB', 2001)
nhanes("SSCHL_B")
y <- nhanes("SSCHL_B")
nhanesTables('LAB', 2002)
nhanesTables('LAB', 2003)[1,]
nhanesTables('LAB', 2003)
nhanesTables('LAB', 2004)
nhanesTables('LAB', 2005)
nhanesTables('LAB', 2006)
nhanesTables('LAB', 2007)
nhanesTables('LAB', 2008)
nhanesTables('LAB', 2009)
nhanesTables('LAB', 2010)
nhanesTables('LAB', 2011)
nhanesTables('LAB', 2010)
nhanesTables('LAB', 201)
nhanesTables('LAB', 2011)
nhanesTables('LAB', 2012)
nhanesTables('LAB', 2013)
nhanesTables('LAB', 2014)
nhanesTables('LAB', 2015)
nhanesTables('LAB', 2016)
nhanesTables('LAB', 2017)
nhanesTables('LAB', 2018)
nhanesTables('LAB', 2019)
nhanesTables('LAB', 2020)
nhanesTables('Q', 2002)
nhanesTables('DEMO', 2002)
nhanesTableVars('DEMO', 'DEMO_B')
nhanesTables('DEMO', 2000)
nhanesTables('DEMO', 2003)
nhanesTables('DEMO', 2011)
nhanesTables('DEMO', 2013)
install.packages("optparse")
"~/Downloads/amino-acid-lookup.csv" %>% read_csv()
j <-"~/Downloads/amino-acid-lookup.csv" %>% read_csv()
j$generated[1]
j$generated[1] == "x"
j$generated[1] != "x"
is.na(j$generated[1])
x <- "~/Documents/GitHub/aa-mut-counter/analyses/Ala/mut-rates.rds" %>% readRDS()
x
x <- "~/Documents/GitHub/aa-mut-counter/analyses/Ala/mut-cancer-contributions.rds" %>% readRDS()
x
setwd("~/Documents/GitHub/aa-mut-counter/code/")
amino_acid <- "Cys"
outdir <- paste0("../analyses/", amino_acid)
if (!dir.exists(outdir)){
dir.create(outdir, recursive = TRUE)
}
#functions
#perform confidence interval simulations
conf_int <- function(lambda, n=2000){
values <- rpois(n=n, lambda=lambda)
bounds <- quantile(values, c(0.025, 0.975)) %>% unname()
return(list(lb = bounds[1], ub = bounds[2]))
}
#load Seer data
#same as SuppTable1_ROSETTA_Abundance_added12.xlsx in Stites 2021
seer.df <- "../data/seer-abundances.xlsx" %>% read_excel() %>% magrittr::set_colnames(c("rosetta", "cancer", "incidence")) %>% mutate(incidence_frac = incidence / 100)
library(readxl)
library(tidyverse)
outdir <- paste0("../analyses/", amino_acid)
if (!dir.exists(outdir)){
dir.create(outdir, recursive = TRUE)
}
#functions
#perform confidence interval simulations
conf_int <- function(lambda, n=2000){
values <- rpois(n=n, lambda=lambda)
bounds <- quantile(values, c(0.025, 0.975)) %>% unname()
return(list(lb = bounds[1], ub = bounds[2]))
}
#load Seer data
#same as SuppTable1_ROSETTA_Abundance_added12.xlsx in Stites 2021
seer.df <- "../data/seer-abundances.xlsx" %>% read_excel() %>% magrittr::set_colnames(c("rosetta", "cancer", "incidence")) %>% mutate(incidence_frac = incidence / 100)
#by mutation
aa_tcga <- paste0("../results/counts-", amino_acid, ".txt") %>% read_table()
#by gene (not important for getting total cases)
all_cases <- "../results/all-muts/all-counts-matrix.txt" %>% read_table() %>% filter(Hugo_Symbol == "Total")
#at least 1 x2c mutation
total_cases <- aa_tcga %>% filter(Hugo_Symbol == "Total")
all_cases_subset <- all_cases %>% select(intersect(colnames(all_cases), colnames(aa_tcga))) %>% relocate(colnames(aa_tcga))
aa_tcga <- rbind(aa_tcga %>% filter(Hugo_Symbol != "Total"), all_cases_subset)
aa_tcga_by_mut <- aa_tcga %>% select(All)
aa_tcga_by_rosetta <- aa_tcga %>% filter(Hugo_Symbol == "Total")
aa_tcga.df <- aa_tcga %>% filter(Hugo_Symbol != "Total") %>% select(-All)
### WRITE OUT FILE ####
#What fraction of cases for a given ROSETTA code have at least 1 mutation of interest?
total_cases$Hugo_Symbol <- paste0("cases with >= 1 acquired ", amino_acid)
all_cases_subset$Hugo_Symbol <- "total sequenced cases"
colnames(all_cases_subset)[1] <- "status"
colnames(total_cases)[1] <- "status"
rbind(total_cases, all_cases_subset) %>% as_tibble() %>% writexl::write_xlsx(., file.path(outdir, "cases-by-rosetta.xlsx"))
#renormalize weight vector to 1
total <- aa_tcga_by_rosetta %>% pivot_longer(-c(Hugo_Symbol, All)) %>% left_join(seer.df, by=c("name"="rosetta"))
total <- total %>% mutate(incidence = incidence / sum(incidence), incidence_frac = incidence_frac / sum(incidence_frac))
total <- total %>% magrittr::set_colnames(c("hugo", "all", "rosetta", "count", "cancer", "incidence", "incidence_frac"))
tcga.muts <- aa_tcga.df %>% pivot_longer(-Hugo_Symbol) %>% left_join(total %>% select(-c(count, hugo, all)), by=c("name"="rosetta"))
tcga.muts <- tcga.muts %>% mutate(gene = gsub("\\.(.*)", "", Hugo_Symbol)) %>% magrittr::set_colnames(c("hugo", "rosetta", "count", "cancer", "incidence", "incidence_frac", "gene"))
tcga.gene <- tcga.muts %>% group_by(gene, cancer) %>% summarize(net_count=sum(count), incidence_frac = unique(incidence_frac), gene = unique(gene), rosetta = unique(rosetta)) %>% select(rosetta, incidence_frac, gene, net_count)
tcga.gene <- tcga.gene %>% mutate(weight.gene = incidence_frac * net_count)
total <- total %>% mutate(weight.tot = incidence_frac * count)
tcga.muts <- tcga.muts %>% mutate(weight.mut=incidence_frac * count)
tcga.muts <- tcga.muts %>% mutate(idx = 1:n())
tcga.gene <- tcga.gene %>% ungroup() %>% mutate(idx = 1:n())
tcga.gene
