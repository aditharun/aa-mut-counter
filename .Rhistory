labs(y = "", x = "Average Change in Excess AAMR", fill = "") +   geom_errorbar(aes(xmin = lower, xmax = upper), position = position_dodge(width = 0.8), width = 0.2, color = "grey60", size = 0.55) +
theme_minimal() + theme(panel.border = element_rect(color = "black", fill = "transparent"), panel.grid = element_blank()) + geom_vline(xintercept = 0, color = "grey30") + theme(panel.grid.major.y = element_line(color = "grey90", linetype = "dashed", linewidth = 0.5)) + scale_fill_manual(values = c("Decline" = cpal[1], "Non-decline" = cpal[2]), labels = c("Decline" = "Decline (1999-2014)", "Non-decline" = "Non-Decline (2015-2019)")) + ggtitle("Males") + theme(plot.title = element_text(size = 14, hjust = 0.5)) + theme(legend.position = "bottom") + theme(axis.text = element_text(size = 12, axis.title = element_text(size = 14)))
m_avg_rate %>% ggplot( aes(y = name, x = slope, fill = plateau)) +
geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.75) +
labs(y = "", x = "Average Change in Excess AAMR", fill = "") +   geom_errorbar(aes(xmin = lower, xmax = upper), position = position_dodge(width = 0.8), width = 0.2, color = "grey60", size = 0.55) +
theme_minimal() + theme(panel.border = element_rect(color = "black", fill = "transparent"), panel.grid = element_blank()) + geom_vline(xintercept = 0, color = "grey30") + theme(panel.grid.major.y = element_line(color = "grey90", linetype = "dashed", linewidth = 0.5)) + scale_fill_manual(values = c("Decline" = cpal[1], "Non-decline" = cpal[2]), labels = c("Decline" = "Decline (1999-2014)", "Non-decline" = "Non-Decline (2015-2019)")) + ggtitle("Males") + theme(plot.title = element_text(size = 14, hjust = 0.5)) + theme(legend.position = "bottom") + theme(axis.text = element_text(size = 12), axis.title = element_text(size = 14))
m_avg_rate %>% ggplot( aes(y = name, x = slope, fill = plateau)) +
geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.75) +
labs(y = "", x = "Average Change in Excess AAMR", fill = "") +   geom_errorbar(aes(xmin = lower, xmax = upper), position = position_dodge(width = 0.8), width = 0.2, color = "grey60", size = 0.55) +
theme_minimal() + theme(panel.border = element_rect(color = "black", fill = "transparent"), panel.grid = element_blank()) + geom_vline(xintercept = 0, color = "grey30") + theme(panel.grid.major.y = element_line(color = "grey90", linetype = "dashed", linewidth = 0.5)) + scale_fill_manual(values = c("Decline" = cpal[1], "Non-decline" = cpal[2]), labels = c("Decline" = "Decline (1999-2014)", "Non-decline" = "Non-Decline (2015-2019)")) + ggtitle("Males") + theme(plot.title = element_text(size = 14, hjust = 0.5)) + theme(legend.position = "bottom") + theme(axis.text = element_text(size = 12), axis.title = element_text(size = 14), legend.text = element_text(size = 12))
fig2a <- m_avg_rate %>% ggplot( aes(y = name, x = slope, fill = plateau)) +
geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.75) +
labs(y = "", x = "Average Change in Excess AAMR", fill = "") +   geom_errorbar(aes(xmin = lower, xmax = upper), position = position_dodge(width = 0.8), width = 0.2, color = "grey60", size = 0.55) +
theme_minimal() + theme(panel.border = element_rect(color = "black", fill = "transparent"), panel.grid = element_blank()) + geom_vline(xintercept = 0, color = "grey30") + theme(panel.grid.major.y = element_line(color = "grey90", linetype = "dashed", linewidth = 0.5)) + scale_fill_manual(values = c("Decline" = cpal[1], "Non-decline" = cpal[2]), labels = c("Decline" = "Decline (1999-2014)", "Non-decline" = "Non-Decline (2015-2019)")) + ggtitle("Males") + theme(plot.title = element_text(size = 14, hjust = 0.5)) + theme(legend.position = "bottom") + theme(axis.text = element_text(size = 12), axis.title = element_text(size = 14), legend.text = element_text(size = 12))
fig2b <- f_avg_rate %>% ggplot( aes(y = name, x = slope, fill = plateau)) +
geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.75) +
labs(y = "", x = "Average Change in Excess AAMR", fill = "") +   geom_errorbar(aes(xmin = lower, xmax = upper), position = position_dodge(width = 0.8), width = 0.2, color = "grey60", size = 0.55) +
theme_minimal() + theme(panel.border = element_rect(color = "black", fill = "transparent"), panel.grid = element_blank()) + geom_vline(xintercept = 0, color = "grey30") + theme(panel.grid.major.y = element_line(color = "grey90", linetype = "dashed", linewidth = 0.5)) + scale_fill_manual(values = c("Decline" = cpal[1], "Non-decline" = cpal[2]), labels = c("Decline" = "Decline (1999-2015)", "Non-decline" = "Non-Decline (2016-2019)")) + ggtitle("Females") + theme(plot.title = element_text(size = 14, hjust = 0.5)) + theme(legend.position = "bottom") + theme(axis.text = element_text(size = 12), axis.title = element_text(size = 14), legend.text = element_text(size = 12))
fig2a
fig2b
fig2b + xlim(-5, 5)
fig2a <- m_avg_rate %>% ggplot( aes(y = name, x = slope, fill = plateau)) +
geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.75) +
labs(y = "", x = "Average Change in Excess AAMR", fill = "") +   geom_errorbar(aes(xmin = lower, xmax = upper), position = position_dodge(width = 0.8), width = 0.2, color = "grey60", size = 0.55) +
theme_minimal() + theme(panel.border = element_rect(color = "black", fill = "transparent"), panel.grid = element_blank()) + geom_vline(xintercept = 0, color = "grey30") + theme(panel.grid.major.y = element_line(color = "grey90", linetype = "dashed", linewidth = 0.5)) + scale_fill_manual(values = c("Decline" = cpal[1], "Non-decline" = cpal[2]), labels = c("Decline" = "Decline (1999-2014)", "Non-decline" = "Non-Decline (2015-2019)")) + ggtitle("Males") + theme(plot.title = element_text(size = 14, hjust = 0.5)) + theme(legend.position = "bottom") + theme(axis.text = element_text(size = 12), axis.title = element_text(size = 14), legend.text = element_text(size = 12)) + xlim(-5, 5)
fig2b <- f_avg_rate %>% ggplot( aes(y = name, x = slope, fill = plateau)) +
geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.75) +
labs(y = "", x = "Average Change in Excess AAMR", fill = "") +   geom_errorbar(aes(xmin = lower, xmax = upper), position = position_dodge(width = 0.8), width = 0.2, color = "grey60", size = 0.55) +
theme_minimal() + theme(panel.border = element_rect(color = "black", fill = "transparent"), panel.grid = element_blank()) + geom_vline(xintercept = 0, color = "grey30") + theme(panel.grid.major.y = element_line(color = "grey90", linetype = "dashed", linewidth = 0.5)) + scale_fill_manual(values = c("Decline" = cpal[1], "Non-decline" = cpal[2]), labels = c("Decline" = "Decline (1999-2015)", "Non-decline" = "Non-Decline (2016-2019)")) + ggtitle("Females") + theme(plot.title = element_text(size = 14, hjust = 0.5)) + theme(legend.position = "bottom") + theme(axis.text = element_text(size = 12), axis.title = element_text(size = 14), legend.text = element_text(size = 12)) + xlim(-5, 5)
fig2 <- plot_grid(fig2a, fig2b, nrow = 1, labels = c("A", "B"), label_size = 20)
fig2
f_avg_rate %>% ggplot( aes(y = name, x = slope, fill = plateau)) +
geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.75) +
labs(y = "", x = "Average Change in Excess AAMR", fill = "") +   geom_errorbar(aes(xmin = lower, xmax = upper), position = position_dodge(width = 0.8), width = 0.2, color = "grey60", size = 0.55) +
theme_minimal() + theme(panel.border = element_rect(color = "black", fill = "transparent"), panel.grid = element_blank()) + geom_vline(xintercept = 0, color = "grey30") + theme(panel.grid.major.y = element_line(color = "grey90", linetype = "dashed", linewidth = 0.5)) + scale_fill_manual(values = c("Decline" = cpal[1], "Non-decline" = cpal[2]), labels = c("Decline" = "Decline (1999-2015)", "Non-decline" = "Non-Decline (2016-2019)"), guide = guide_legend(nrow = 2)) + ggtitle("Females") + theme(plot.title = element_text(size = 14, hjust = 0.5)) + theme(legend.position = "bottom") + theme(axis.text = element_text(size = 12), axis.title = element_text(size = 14), legend.text = element_text(size = 12)) + xlim(-5, 5)
fig2a <- m_avg_rate %>% ggplot( aes(y = name, x = slope, fill = plateau)) +
geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.75) +
labs(y = "", x = "Average Change in Excess AAMR", fill = "") +   geom_errorbar(aes(xmin = lower, xmax = upper), position = position_dodge(width = 0.8), width = 0.2, color = "grey60", size = 0.55) +
theme_minimal() + theme(panel.border = element_rect(color = "black", fill = "transparent"), panel.grid = element_blank()) + geom_vline(xintercept = 0, color = "grey30") + theme(panel.grid.major.y = element_line(color = "grey90", linetype = "dashed", linewidth = 0.5)) + scale_fill_manual(values = c("Decline" = cpal[1], "Non-decline" = cpal[2]), labels = c("Decline" = "Decline (1999-2014)", "Non-decline" = "Non-Decline (2015-2019)"), guide = guide_legend(nrow = 2)) + ggtitle("Males") + theme(plot.title = element_text(size = 14, hjust = 0.5)) + theme(legend.position = "bottom") + theme(axis.text = element_text(size = 12), axis.title = element_text(size = 14), legend.text = element_text(size = 12)) + xlim(-5, 5)
fig2b <- f_avg_rate %>% ggplot( aes(y = name, x = slope, fill = plateau)) +
geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.75) +
labs(y = "", x = "Average Change in Excess AAMR", fill = "") +   geom_errorbar(aes(xmin = lower, xmax = upper), position = position_dodge(width = 0.8), width = 0.2, color = "grey60", size = 0.55) +
theme_minimal() + theme(panel.border = element_rect(color = "black", fill = "transparent"), panel.grid = element_blank()) + geom_vline(xintercept = 0, color = "grey30") + theme(panel.grid.major.y = element_line(color = "grey90", linetype = "dashed", linewidth = 0.5)) + scale_fill_manual(values = c("Decline" = cpal[1], "Non-decline" = cpal[2]), labels = c("Decline" = "Decline (1999-2015)", "Non-decline" = "Non-Decline (2016-2019)"), guide = guide_legend(nrow = 2)) + ggtitle("Females") + theme(plot.title = element_text(size = 14, hjust = 0.5)) + theme(legend.position = "bottom") + theme(axis.text = element_text(size = 12), axis.title = element_text(size = 14), legend.text = element_text(size = 12)) + xlim(-5, 5)
fig2 <- plot_grid(fig2a, fig2b, nrow = 1, labels = c("A", "B"), label_size = 20)
fig2
fig2 %>% ggsave(filename = "~/Desktop/decline-fig2.pdf", plot = ., device = cairo_pdf, height = 8, width = 15, units = "in")
m_avg_rate
fig2a <- m_avg_rate %>% mutate(name = ifelse(grepl("Perinatal", name), "Perinatal Period Conditions", name)) %>% ggplot( aes(y = name, x = slope, fill = plateau)) +
geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.75) +
labs(y = "", x = "Average Change in Excess AAMR", fill = "") +   geom_errorbar(aes(xmin = lower, xmax = upper), position = position_dodge(width = 0.8), width = 0.2, color = "grey60", size = 0.55) +
theme_minimal() + theme(panel.border = element_rect(color = "black", fill = "transparent"), panel.grid = element_blank()) + geom_vline(xintercept = 0, color = "grey30") + theme(panel.grid.major.y = element_line(color = "grey90", linetype = "dashed", linewidth = 0.5)) + scale_fill_manual(values = c("Decline" = cpal[1], "Non-decline" = cpal[2]), labels = c("Decline" = "Decline (1999-2014)", "Non-decline" = "Non-Decline (2015-2019)"), guide = guide_legend(nrow = 2)) + ggtitle("Males") + theme(plot.title = element_text(size = 14, hjust = 0.5)) + theme(legend.position = "bottom") + theme(axis.text = element_text(size = 12), axis.title = element_text(size = 14), legend.text = element_text(size = 12)) + xlim(-5, 5)
fig2b <- f_avg_rate %>% ggplot( aes(y = name, x = slope, fill = plateau)) +
geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.75) +
labs(y = "", x = "Average Change in Excess AAMR", fill = "") +   geom_errorbar(aes(xmin = lower, xmax = upper), position = position_dodge(width = 0.8), width = 0.2, color = "grey60", size = 0.55) +
theme_minimal() + theme(panel.border = element_rect(color = "black", fill = "transparent"), panel.grid = element_blank()) + geom_vline(xintercept = 0, color = "grey30") + theme(panel.grid.major.y = element_line(color = "grey90", linetype = "dashed", linewidth = 0.5)) + scale_fill_manual(values = c("Decline" = cpal[1], "Non-decline" = cpal[2]), labels = c("Decline" = "Decline (1999-2015)", "Non-decline" = "Non-Decline (2016-2019)"), guide = guide_legend(nrow = 2)) + ggtitle("Females") + theme(plot.title = element_text(size = 14, hjust = 0.5)) + theme(legend.position = "bottom") + theme(axis.text = element_text(size = 12), axis.title = element_text(size = 14), legend.text = element_text(size = 12)) + xlim(-5, 5)
fig2 <- plot_grid(fig2a, fig2b, nrow = 1, labels = c("A", "B"), label_size = 20)
fig2 %>% ggsave(filename = "~/Desktop/decline-fig2.pdf", plot = ., device = cairo_pdf, height = 8, width = 15, units = "in")
m_avg_rate
m_avg_rate %>% mutate(name = ifelse(grepl("Perinatal", name), "yes", name))
fig2 %>% ggsave(filename = "~/Desktop/decline-fig2.pdf", plot = ., device = cairo_pdf, height = 10, width = 15, units = "in")
fig2a <- m_avg_rate  %>% ggplot( aes(y = name, x = slope, fill = plateau)) +
geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.75) +
labs(y = "", x = "Average Change in Excess AAMR", fill = "") +   geom_errorbar(aes(xmin = lower, xmax = upper), position = position_dodge(width = 0.8), width = 0.2, color = "grey60", size = 0.55) +
theme_minimal() + theme(panel.border = element_rect(color = "black", fill = "transparent"), panel.grid = element_blank()) + geom_vline(xintercept = 0, color = "grey30") + theme(panel.grid.major.y = element_line(color = "grey90", linetype = "dashed", linewidth = 0.5)) + scale_fill_manual(values = c("Decline" = cpal[1], "Non-decline" = cpal[2]), labels = c("Decline" = "Decline (1999-2014)", "Non-decline" = "Non-Decline (2015-2019)"), guide = guide_legend(nrow = 2)) + ggtitle("Males") + theme(plot.title = element_text(size = 14, hjust = 0.5)) + theme(legend.position = "bottom") + theme(axis.text = element_text(size = 12), axis.title = element_text(size = 14), legend.text = element_text(size = 12)) + xlim(-5, 5)
fig2b <- f_avg_rate %>% ggplot( aes(y = name, x = slope, fill = plateau)) +
geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.75) +
labs(y = "", x = "Average Change in Excess AAMR", fill = "") +   geom_errorbar(aes(xmin = lower, xmax = upper), position = position_dodge(width = 0.8), width = 0.2, color = "grey60", size = 0.55) +
theme_minimal() + theme(panel.border = element_rect(color = "black", fill = "transparent"), panel.grid = element_blank()) + geom_vline(xintercept = 0, color = "grey30") + theme(panel.grid.major.y = element_line(color = "grey90", linetype = "dashed", linewidth = 0.5)) + scale_fill_manual(values = c("Decline" = cpal[1], "Non-decline" = cpal[2]), labels = c("Decline" = "Decline (1999-2015)", "Non-decline" = "Non-Decline (2016-2019)"), guide = guide_legend(nrow = 2)) + ggtitle("Females") + theme(plot.title = element_text(size = 14, hjust = 0.5)) + theme(legend.position = "bottom") + theme(axis.text = element_text(size = 12), axis.title = element_text(size = 14), legend.text = element_text(size = 12)) + xlim(-5, 5)
fig2 <- plot_grid(fig2a, fig2b, nrow = 1, labels = c("A", "B"), label_size = 20)
fig2 %>% ggsave(filename = "~/Desktop/decline-fig2.pdf", plot = ., device = cairo_pdf, height = 10, width = 15, units = "in")
library(tidyverse)
ageadj_file <- "~/Downloads/Underlying Cause of Death, 1999-2020 (23).txt" %>% read_delim(., delim='\t') %>% slice(1:(1675-91))
ageadj <- ageadj_file %>% select(Year, `ICD-10 113 Cause List`, Race, Gender, Deaths, Population, `Age Adjusted Rate`) %>% magrittr::set_colnames(c("year", "icd", "race", "gender", "deaths", "population", "ageadjrate"))
#NA year is 2020
ageadj <- ageadj %>% mutate(year = ifelse(is.na(year), 2020, year))
ageadj <- ageadj %>% mutate(race = ifelse(race == "White", "white", "black"))
ageadj
ageadj_file <- "~/Downloads/Underlying Cause of Death, 1999-2020 (23).txt" %>% read_delim(., delim='\t') %>% slice(1:(1675-91))
ageadj <- ageadj_file %>% select(Year, `ICD-10 113 Cause List`, Race, Gender, Deaths, Population, `Age Adjusted Rate`) %>% magrittr::set_colnames(c("year", "icd", "race", "gender", "deaths", "population", "ageadjrate"))
#NA year is 2020
ageadj <- ageadj %>% mutate(year = ifelse(is.na(year), 2020, year))
ageadj <- ageadj %>% mutate(race = ifelse(race == "White", "white", "black"))
ageadj <- ageadj %>% group_by(year, icd, gender) %>% summarize(unadj_excess_num = deaths[race=="black"] - (population[race=="black"] * (deaths[race=="white"]/population[race=="black"])), ageadj_excess = ageadjrate[race=="black"] - ageadjrate[race=="white"]) %>% ungroup()
#Methods: excess AAMR
icd_map <- ageadj %>% select(icd) %>% distinct() %>% mutate(name=c("Accidents", "Alzheimer's", "Assault", "Cerebrovascular Diseases", "Perinatal Period Conditions", "Chronic Liver Disease and Cirrhosis", "Chronic Lower Respiratory Diseases", "Diabetes", "Heart Disease", "Hypertension", "HIV", "Influenza and Pneumonia", "Suicide", "Cancer", "Nephritis", "Parkinson's", "Pneumonitis due to Solids/Liquids", "Septicemia"))
#top causes of death ageadj
ageadj <- ageadj %>% left_join(icd_map, by=c("icd"="icd")) %>% select(-icd)
#overall ageadj
net_excess_ageadj <- "~/Downloads/Figure1/age_adj_excess_mortality_rate_by_years_Figure1.csv" %>% read_csv()
######### PLOTTING and ANALYSIS #######################
overall_ageadj_changes <- net_excess_ageadj %>% group_by(gender, year) %>% group_by(gender) %>% arrange(year) %>% mutate(pct_yoy_change_mag = ((abs(excess_deaths_rate - lag(excess_deaths_rate))) / abs(lag(excess_deaths_rate))) * 100, direction = sign(excess_deaths_rate - lag(excess_deaths_rate)), change = excess_deaths_rate - lag(excess_deaths_rate), pct_yoy_change = pct_yoy_change_mag * direction) %>% ungroup()
#overall change by year and excess deaths rate each year
overall_ageadj_changes %>% select(race, gender, year, excess_deaths_rate) %>% ggplot(aes(x=year, y=excess_deaths_rate, color=race)) + geom_line() + geom_point() + theme_minimal() + facet_wrap(~gender)
overall_ageadj_changes %>% select(race, gender, year, change) %>% ggplot(aes(x=year, y=change, color=race)) + geom_line() + geom_point() + theme_minimal() + facet_wrap(~gender)
overall_ageadj_changes %>% select(race, gender, year, change) %>% filter(gender == "Male") %>% mutate(color = ifelse(year <= 2011, "green", "blue")) %>% ggplot(aes(x = factor(year), y = change, fill = color)) + geom_bar(stat = "identity", show.legend = FALSE) + scale_fill_manual(values = c("green", "blue")) + scale_x_discrete(breaks = c(2000:2011, 2012:2020)) + theme_minimal() + labs(x = "Year", y = "Change")
#what pct of ageadj deaths excess are captured in the top causes of death yoy
ageadj %>% group_by(year, gender) %>% summarize(net = sum(ageadj_excess)) %>% ungroup() %>% left_join(net_excess_ageadj, by=c("gender"="gender", "year"="year")) %>% mutate(pct_captured = round((net*100) / excess_deaths_rate)) %>% pull(pct_captured)
#what's driving the decline
df <- ageadj %>% group_by(gender, name) %>% arrange(year) %>% mutate(pct_yoy_change_mag = ((abs(ageadj_excess - lag(ageadj_excess))) / abs(lag(ageadj_excess))) * 100, direction = sign(ageadj_excess - lag(ageadj_excess)), change = ageadj_excess - lag(ageadj_excess), pct_yoy_change = pct_yoy_change_mag * direction) %>% ungroup()
df <- df %>% select(year, gender, change, name) %>% left_join(overall_ageadj_changes %>% select(gender, year, change) %>% magrittr::set_colnames(c("gender", "year", "ovr_change"))) %>% filter(year > 1999)
#the remaining 15% AAMR that is not accounted for by top causes of death
tail_change <- df %>% group_by(year, gender) %>% summarize(nc = sum(change), t = unique(ovr_change)) %>% ungroup() %>% mutate(Tail = t - nc) %>% select(year, gender, Tail) %>% mutate(name = "Tail") %>% magrittr::set_colnames(c("year", "gender", "change", "name"))
df <- df %>% select(-ovr_change) %>% rbind(tail_change)
#change for each condition to get to excess AAMR for year
#can figure out what is driving the decline
#can create a figure saying for the decline period, what is the rank of the condition e.g. cancer across years
#can i use this to figure out what is driving the plateau??? I'm not sold I can.
cowplot::plot_grid(plotlist = lapply(dfstack, function(dfs) dfs %>% ggplot(aes(x = factor(name, levels = (dfs %>% arrange(change) %>% pull(name))), y = change)) + geom_bar(stat = "identity", show.legend = FALSE) + theme_minimal() + ylab("Change") + xlab("") + coord_flip() + facet_wrap(~year, scales="free") ), ncol = 1)
#FIGURE TO DO::
### NEED TO FIX COLOR SCHEME
### FIGURE 2
### Figure 1
name_map <- data.frame(name = ageadj %>% pull(name) %>% unique(), new_name = c("Accidents", "Alzheimer's", "Assault", "Cerebrovascular\nDiseases", "Perinatal Period\nConditions", "Chronic Liver\nDisease and Cirrhosis", "Chronic Lower\nRespiratory Diseases", "Diabetes", "Heart Diease", "Hypertension", "HIV", "Influenza\nand Pneumonia", "Suicide", "Cancer", "Nephritis", "Parkinson's", "Pneumonitis due to\nSolids and Liquids", "Septicemia")) %>% as_tibble()
ageadj <- ageadj %>% left_join(name_map, by=c("name"="name")) %>% select(-name) %>% magrittr::set_colnames(c("year", "gender", "unadj_excess_num", "ageadj_excess", "name"))
## Panel A: overall excess age adjusted
overall_ageadj_changes %>% select(race, gender, year, change) %>% ggplot(aes(x=year, y=change, color=race)) + geom_line() + geom_point() + theme_minimal() + facet_wrap(~gender)
overall_ageadj_changes <- overall_ageadj_changes %>% mutate(plateau_F = ifelse(gender == "Female", ifelse(year > 2015, "Non-decline", "Decline"), "Decline")) %>% mutate(plateau_M = ifelse(gender == "Male", ifelse(year > 2011, "Non-decline", "Decline"), "Decline")) %>% mutate(plateau = ifelse(gender == "Male", plateau_M, plateau_F))
cpal <- c("#374e55", "#df8f44")
fig1a <- overall_ageadj_changes %>% ggplot(aes(x=year, y=excess_deaths_rate, shape=gender)) + geom_line(size = 0.75, color = "grey70") + geom_point(size = 3.25, aes(color = plateau)) + theme_minimal() + theme(panel.border = element_rect(color = "black", fill = "transparent")) + scale_y_continuous(breaks = seq(-100, 450, 50), labels = seq(-100, 450, 50), limits = c(-100, 450)) + geom_hline(yintercept = 0, linetype = "dashed", color = "grey70", linewidth = 0.65) + scale_x_continuous(breaks=seq(1999, 2020, 1), labels= function(x) ifelse(x %% 2 == 1, x, "")) + theme(axis.ticks = element_line(color = "black")) + ylab("Excess AAMR per\n100,000 Individuals") + xlab("Year") + theme(legend.title = element_blank(), legend.text = element_text(size = 12), axis.title = element_text(size = 12), axis.text = element_text(size = 9)) + ggtitle("Excess Age-Adjusted Mortality Rates") + theme(plot.title = element_text(hjust = 0.5, size = 15))  + theme(panel.grid = element_blank()) + geom_vline(xintercept = 2012, color = "grey80", linetype = "dashed", linewidth = 0.35) + geom_vline(xintercept = 2016, color = "grey80", linetype = "dashed", linewidth = 0.35) + scale_color_manual(values = c("Decline" = cpal[1], "Non-decline" = cpal[2]), labels = c("Decline" = "Decline", "Non-decline" = "Non-Decline"))
#may need to throw out 2020 becaue so high
fig1b <- overall_ageadj_changes %>% filter(gender == "Male") %>% mutate(color = ifelse(year <= 2011, "Decline", "Non-Decline")) %>% ggplot(aes(x = year, y = change, fill = color)) + geom_bar(stat = "identity") + theme_minimal() + scale_y_continuous(breaks = scales::pretty_breaks(n = 10)) + geom_hline(yintercept = 0, linetype = "dashed", color = "grey70", linewidth = 0.65) + scale_x_continuous(breaks=seq(2000, 2020, 1), labels= function(x) ifelse(x %% 2 == 0, x, "")) + theme(panel.border = element_rect(color = "black", fill = "transparent"), panel.grid.major.x = element_blank(), panel.grid.minor.y = element_blank()) + theme(axis.ticks = element_line(color = "black")) + ylab("Excess AAMR\nChange") + xlab("Year") + theme(legend.title = element_blank(), legend.text = element_text(size = 10)) + ggtitle("Yearly Excess AAMR Change for Males") + theme(plot.title = element_text(hjust = 0.5, size = 14)) + theme(panel.grid = element_blank()) + scale_fill_manual(values = c("Decline" = cpal[1], "Non-Decline" = cpal[2])) + theme(legend.title = element_blank(), legend.text = element_text(size = 12), axis.title = element_text(size = 12), axis.text = element_text(size = 9))
#copy of 1b but switch to female gender and year of decline is 2015
fig1c <- overall_ageadj_changes %>% filter(gender == "Female") %>% mutate(color = ifelse(year <= 2015, "Decline", "Non-Decline")) %>% ggplot(aes(x = year, y = change, fill = color)) + geom_bar(stat = "identity") + theme_minimal() + scale_y_continuous(breaks = scales::pretty_breaks(n = 10)) + geom_hline(yintercept = 0, linetype = "dashed", color = "grey70") + scale_x_continuous(breaks=seq(2000, 2020, 1), labels= function(x) ifelse(x %% 2 == 0, x, "")) + theme(panel.border = element_rect(color = "black", fill = "transparent"), panel.grid.major.x = element_blank(), panel.grid.minor.y = element_blank()) + theme(axis.ticks = element_line(color = "black")) + ylab("Excess AAMR\nChange") + xlab("Year")  + theme(legend.title = element_blank(), legend.text = element_text(size = 10)) + ggtitle("Yearly Excess AAMR Change for Females") + theme(plot.title = element_text(hjust = 0.5, size = 14)) + theme(plot.title = element_text(hjust = 0.5, size = 14)) + theme(panel.grid = element_blank()) + scale_fill_manual(values = c("Decline" = cpal[1], "Non-Decline" = cpal[2])) + theme(legend.title = element_blank(), legend.text = element_text(size = 12), axis.title = element_text(size = 12), axis.text = element_text(size = 9))
library(cowplot)
#top half of figure 1
right_half_fig1 <- cowplot::plot_grid(fig1b, fig1c, nrow = 2, ncol = 1, labels = c("B", "C"), label_size = 20)
top_half_fig1 <- plot_grid(fig1a, right_half_fig1, nrow = 1, labels = c("A", ""), label_size = 20)
#lineplot figure panels
order.of.conditions <- ageadj %>% group_by(name) %>% summarize(x = mean(ageadj_excess)) %>% arrange(desc(x)) %>% pull(name)
#copy for females and figure 1 done
#adds in the tail variabls
#ageadj <- rbind(ageadj %>% select(year, gender, ageadj_excess, name), ageadj %>% select(year, gender, ageadj_excess, name) %>% left_join(overall_ageadj_changes %>% select(gender, year, excess_deaths_rate), by=c("gender"="gender", "year"="year")) %>% group_by(year, gender) %>% summarize(nc = sum(ageadj_excess), t = unique(excess_deaths_rate)) %>% ungroup() %>% mutate(Tail = t - nc) %>% select(year, gender, Tail) %>% mutate(name = "Tail") %>% magrittr::set_colnames(c("year", "gender", "ageadj_excess", "name")))
m_ageadj_stack <- ageadj %>% filter(gender == "Male") %>% mutate(name = factor(name, levels = order.of.conditions)) %>% group_by(name) %>% group_split()
m_pltagestack <- lapply(m_ageadj_stack, function(astack) astack %>% filter(gender == "Male") %>% mutate(plateau = ifelse(year <= 2011, "Decline", "Non-Decline")) %>% ggplot(aes(x=year, y=ageadj_excess, color = plateau)) + geom_point(size = 3) + geom_line(size = 0.85, color = "grey65") + theme_minimal() + theme(legend.position = "none") + geom_vline(xintercept = 2012, linetype = "dashed", color = "grey70") + scale_x_continuous(breaks = c(2000, 2010, 2020), labels = c(2000, 2010, 2020)) + theme(axis.line.x = element_line(color = "black"), axis.line.y = element_line(color = "black")) + theme(axis.ticks = element_line(color = "black")) + ylab("Excess AAMR") + xlab("") + theme(panel.grid = element_blank()) + xlab("") + theme(axis.text = element_text(size = 10), axis.title = element_text(size = 10)) + ggtitle(unique(astack$name)) + theme(plot.title = element_text(hjust = 0.5, size = 14)) + scale_color_manual(values = c("Decline" = cpal[1], "Non-Decline" = cpal[2])) )
fig1d <- cowplot::plot_grid(plotlist = m_pltagestack, nrow = 6, ncol = 3)
f_ageadj_stack <- ageadj %>% filter(gender == "Female") %>% mutate(name = factor(name, levels = order.of.conditions)) %>% group_by(name) %>% group_split()
f_pltagestack <- lapply(f_ageadj_stack, function(astack) astack %>% filter(gender == "Female") %>% mutate(plateau = ifelse(year <= 2015, "Decline", "Non-Decline")) %>% ggplot(aes(x=year, y=ageadj_excess, color = plateau)) + geom_point(size = 3) + geom_line(size = 0.85, color = "grey65") + theme_minimal() + theme(legend.position = "none") + geom_vline(xintercept = 2016, linetype = "dashed", color = "grey70") + scale_x_continuous(breaks = c(2000, 2010, 2020), labels = c(2000, 2010, 2020)) + theme(axis.line.x = element_line(color = "black"), axis.line.y = element_line(color = "black")) + theme(axis.ticks = element_line(color = "black")) + ylab("Excess AAMR") + xlab("") + theme(panel.grid = element_blank()) + xlab("") + theme(axis.text = element_text(size = 10), axis.title = element_text(size = 10)) + ggtitle(unique(astack$name)) + theme(plot.title = element_text(hjust = 0.5, size = 14)) + scale_color_manual(values = c("Decline" = cpal[1], "Non-Decline" = cpal[2])) )
fig1e <- cowplot::plot_grid(plotlist = f_pltagestack, nrow = 6, ncol = 3)
fig1d_new <- plot_grid(ggplot() + theme_void() + ggtitle("Excess AAMR by Top Causes of Death for Males") + theme(plot.title = element_text(hjust = 0.5, size = 14)), fig1d, nrow = 2, rel_heights = c(0.02, 1))
fig1e_new <- plot_grid(ggplot() + theme_void() + ggtitle("Excess AAMR by Top Causes of Death for Females") + theme(plot.title = element_text(hjust = 0.5, size = 14)), fig1e, nrow = 2, rel_heights = c(0.02, 1))
bottom_half_fig1 <- plot_grid(fig1d_new, ggplot() + theme_void(), fig1e_new, nrow = 1, rel_widths = c(1, 0.1, 1), labels = c("D", "E"), label_size = 20)
plot_grid(top_half_fig1, bottom_half_fig1, nrow = 2, ncol = 1, rel_heights = c(0.3, 1)) %>% ggsave(filename = "~/Desktop/decline-fig1-men-2011.pdf", plot = ., device = cairo_pdf, height = 20, width = 15, units = "in")
avg_change <- rbind(ageadj %>% select(year, gender, ageadj_excess, name), ageadj %>% select(year, gender, ageadj_excess, name) %>% left_join(overall_ageadj_changes %>% select(gender, year, excess_deaths_rate), by=c("gender"="gender", "year"="year")) %>% group_by(year, gender) %>% summarize(nc = sum(ageadj_excess), t = unique(excess_deaths_rate)) %>% ungroup() %>% mutate(Tail = t - nc) %>% select(year, gender, Tail) %>% mutate(name = "Tail") %>% magrittr::set_colnames(c("year", "gender", "ageadj_excess", "name")))
#avg_change %>% filter(gender == "Male") %>% group_by(name) %>% summarize(decline_rate = (ageadj_excess[year == 2014] - ageadj_excess[year == 1999]) / (2014 - 1999), plateau_rate = (ageadj_excess[year == 2020] - ageadj_excess[year == 2015]) / (2020 - 2015))
#remove 2020 because its obviously such a problem and just comment on it in the paper
avg_change %>% filter(gender == "Male") %>% group_by(name) %>% summarize(decline_rate = (ageadj_excess[year == 2011] - ageadj_excess[year == 1999]) / (2011 - 1999), plateau_rate = (ageadj_excess[year == 2019] - ageadj_excess[year == 2012]) / (2019 - 2012))
avg_change %>% filter(gender == "Female") %>% group_by(name) %>% summarize(decline_rate = (ageadj_excess[year == 2015] - ageadj_excess[year == 1999]) / (2015 - 1999), plateau_rate = (ageadj_excess[year == 2019] - ageadj_excess[year == 2016]) / (2019 - 2016))
#remove 2020 because its obviously such a problem and just comment on it in the paper
#fit a linear model so I can get confidence interval
get_lm_fits <- function(df){
slope <- coefficients(df %>% lm(ageadj_excess ~ year, .))[[2]]
ci <- (confint(df %>% lm(ageadj_excess ~ year, .), "year"))[1:2]
data.frame(slope = slope, lower = ci[1], upper = ci[2], gender = unique(df$gender), name = unique(df$name), plateau = unique(df$plateau))
}
m_avg_stack <- avg_change %>% filter(gender == "Male") %>% filter(year < 2020) %>% mutate(plateau = ifelse(year <= 2011, "Decline", "Non-decline")) %>% group_by(gender, plateau, name) %>% group_split()
m_avg_rate <- do.call(rbind, m_avg_stack %>% lapply(., function(df) get_lm_fits(df))) %>% as_tibble()
m_order.of.avg.names <- m_avg_rate %>% group_by(name) %>% summarize(diff = slope[plateau == "Decline"] - slope[plateau == "Non-decline"]) %>% arrange(diff) %>% pull(name) %>% rev()
m_avg_rate <- m_avg_rate %>% mutate(name = factor(name, levels = m_order.of.avg.names))
#bar plot version
#dot plot version
#avg_rate %>% ggplot( aes(x = name, y = slope, fill = plateau)) + geom_point(position = position_dodge(width = 0.5)) + labs(x = "Cause of Death", y = "Average Change in Excess AAMR", fill = "") +   geom_errorbar(aes(ymin = lower, ymax = upper), position = position_dodge(width = 0.5), width = 0.25) + theme_minimal()
f_avg_stack <- avg_change %>% filter(gender == "Female") %>% filter(year < 2020) %>% mutate(plateau = ifelse(year <= 2015, "Decline", "Non-decline")) %>% group_by(gender, plateau, name) %>% group_split()
f_avg_rate <- do.call(rbind, f_avg_stack %>% lapply(., function(df) get_lm_fits(df))) %>% as_tibble()
f_order.of.avg.names <- f_avg_rate %>% group_by(name) %>% summarize(diff = slope[plateau == "Decline"] - slope[plateau == "Non-decline"]) %>% arrange(diff) %>% pull(name) %>% rev()
f_avg_rate <- f_avg_rate %>% mutate(name = factor(name, levels = f_order.of.avg.names))
fig2a <- m_avg_rate  %>% ggplot( aes(y = name, x = slope, fill = plateau)) +
geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.75) +
labs(y = "", x = "Average Change in Excess AAMR", fill = "") +   geom_errorbar(aes(xmin = lower, xmax = upper), position = position_dodge(width = 0.8), width = 0.2, color = "grey60", size = 0.55) +
theme_minimal() + theme(panel.border = element_rect(color = "black", fill = "transparent"), panel.grid = element_blank()) + geom_vline(xintercept = 0, color = "grey30") + theme(panel.grid.major.y = element_line(color = "grey90", linetype = "dashed", linewidth = 0.5)) + scale_fill_manual(values = c("Decline" = cpal[1], "Non-decline" = cpal[2]), labels = c("Decline" = "Decline (1999-2014)", "Non-decline" = "Non-Decline (2015-2019)"), guide = guide_legend(nrow = 2)) + ggtitle("Males") + theme(plot.title = element_text(size = 14, hjust = 0.5)) + theme(legend.position = "bottom") + theme(axis.text = element_text(size = 12), axis.title = element_text(size = 14), legend.text = element_text(size = 12)) + xlim(-5, 5)
fig2b <- f_avg_rate %>% ggplot( aes(y = name, x = slope, fill = plateau)) +
geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.75) +
labs(y = "", x = "Average Change in Excess AAMR", fill = "") +   geom_errorbar(aes(xmin = lower, xmax = upper), position = position_dodge(width = 0.8), width = 0.2, color = "grey60", size = 0.55) +
theme_minimal() + theme(panel.border = element_rect(color = "black", fill = "transparent"), panel.grid = element_blank()) + geom_vline(xintercept = 0, color = "grey30") + theme(panel.grid.major.y = element_line(color = "grey90", linetype = "dashed", linewidth = 0.5)) + scale_fill_manual(values = c("Decline" = cpal[1], "Non-decline" = cpal[2]), labels = c("Decline" = "Decline (1999-2015)", "Non-decline" = "Non-Decline (2016-2019)"), guide = guide_legend(nrow = 2)) + ggtitle("Females") + theme(plot.title = element_text(size = 14, hjust = 0.5)) + theme(legend.position = "bottom") + theme(axis.text = element_text(size = 12), axis.title = element_text(size = 14), legend.text = element_text(size = 12)) + xlim(-5, 5)
fig2 <- plot_grid(fig2a, fig2b, nrow = 1, labels = c("A", "B"), label_size = 20)
fig2 %>% ggsave(filename = "~/Desktop/decline-fig2-men-2011.pdf", plot = ., device = cairo_pdf, height = 10, width = 15, units = "in")
library(tidyverse)
ageadj_file <- "~/Downloads/Underlying Cause of Death, 1999-2020 (23).txt" %>% read_delim(., delim='\t') %>% slice(1:(1675-91))
ageadj <- ageadj_file %>% select(Year, `ICD-10 113 Cause List`, Race, Gender, Deaths, Population, `Age Adjusted Rate`) %>% magrittr::set_colnames(c("year", "icd", "race", "gender", "deaths", "population", "ageadjrate"))
#NA year is 2020
ageadj <- ageadj %>% mutate(year = ifelse(is.na(year), 2020, year))
ageadj <- ageadj %>% mutate(race = ifelse(race == "White", "white", "black"))
ageadj <- ageadj %>% group_by(year, icd, gender) %>% summarize(unadj_excess_num = deaths[race=="black"] - (population[race=="black"] * (deaths[race=="white"]/population[race=="black"])), ageadj_excess = ageadjrate[race=="black"] - ageadjrate[race=="white"]) %>% ungroup()
#Methods: excess AAMR
icd_map <- ageadj %>% select(icd) %>% distinct() %>% mutate(name=c("Accidents", "Alzheimer's", "Assault", "Cerebrovascular Diseases", "Perinatal Period Conditions", "Chronic Liver Disease and Cirrhosis", "Chronic Lower Respiratory Diseases", "Diabetes", "Heart Disease", "Hypertension", "HIV", "Influenza and Pneumonia", "Suicide", "Cancer", "Nephritis", "Parkinson's", "Pneumonitis due to Solids/Liquids", "Septicemia"))
#top causes of death ageadj
ageadj <- ageadj %>% left_join(icd_map, by=c("icd"="icd")) %>% select(-icd)
#overall ageadj
net_excess_ageadj <- "~/Downloads/Figure1/age_adj_excess_mortality_rate_by_years_Figure1.csv" %>% read_csv()
######### PLOTTING and ANALYSIS #######################
overall_ageadj_changes <- net_excess_ageadj %>% group_by(gender, year) %>% group_by(gender) %>% arrange(year) %>% mutate(pct_yoy_change_mag = ((abs(excess_deaths_rate - lag(excess_deaths_rate))) / abs(lag(excess_deaths_rate))) * 100, direction = sign(excess_deaths_rate - lag(excess_deaths_rate)), change = excess_deaths_rate - lag(excess_deaths_rate), pct_yoy_change = pct_yoy_change_mag * direction) %>% ungroup()
#overall change by year and excess deaths rate each year
overall_ageadj_changes %>% select(race, gender, year, excess_deaths_rate) %>% ggplot(aes(x=year, y=excess_deaths_rate, color=race)) + geom_line() + geom_point() + theme_minimal() + facet_wrap(~gender)
overall_ageadj_changes %>% select(race, gender, year, change) %>% ggplot(aes(x=year, y=change, color=race)) + geom_line() + geom_point() + theme_minimal() + facet_wrap(~gender)
overall_ageadj_changes %>% select(race, gender, year, change) %>% filter(gender == "Male") %>% mutate(color = ifelse(year <= 2011, "green", "blue")) %>% ggplot(aes(x = factor(year), y = change, fill = color)) + geom_bar(stat = "identity", show.legend = FALSE) + scale_fill_manual(values = c("green", "blue")) + scale_x_discrete(breaks = c(2000:2011, 2012:2020)) + theme_minimal() + labs(x = "Year", y = "Change")
#what pct of ageadj deaths excess are captured in the top causes of death yoy
ageadj %>% group_by(year, gender) %>% summarize(net = sum(ageadj_excess)) %>% ungroup() %>% left_join(net_excess_ageadj, by=c("gender"="gender", "year"="year")) %>% mutate(pct_captured = round((net*100) / excess_deaths_rate)) %>% pull(pct_captured)
#what's driving the decline
df <- ageadj %>% group_by(gender, name) %>% arrange(year) %>% mutate(pct_yoy_change_mag = ((abs(ageadj_excess - lag(ageadj_excess))) / abs(lag(ageadj_excess))) * 100, direction = sign(ageadj_excess - lag(ageadj_excess)), change = ageadj_excess - lag(ageadj_excess), pct_yoy_change = pct_yoy_change_mag * direction) %>% ungroup()
df <- df %>% select(year, gender, change, name) %>% left_join(overall_ageadj_changes %>% select(gender, year, change) %>% magrittr::set_colnames(c("gender", "year", "ovr_change"))) %>% filter(year > 1999)
#the remaining 15% AAMR that is not accounted for by top causes of death
tail_change <- df %>% group_by(year, gender) %>% summarize(nc = sum(change), t = unique(ovr_change)) %>% ungroup() %>% mutate(Tail = t - nc) %>% select(year, gender, Tail) %>% mutate(name = "Tail") %>% magrittr::set_colnames(c("year", "gender", "change", "name"))
df <- df %>% select(-ovr_change) %>% rbind(tail_change)
#change for each condition to get to excess AAMR for year
#can figure out what is driving the decline
#can create a figure saying for the decline period, what is the rank of the condition e.g. cancer across years
#can i use this to figure out what is driving the plateau??? I'm not sold I can.
cowplot::plot_grid(plotlist = lapply(dfstack, function(dfs) dfs %>% ggplot(aes(x = factor(name, levels = (dfs %>% arrange(change) %>% pull(name))), y = change)) + geom_bar(stat = "identity", show.legend = FALSE) + theme_minimal() + ylab("Change") + xlab("") + coord_flip() + facet_wrap(~year, scales="free") ), ncol = 1)
#FIGURE TO DO::
### NEED TO FIX COLOR SCHEME
### FIGURE 2
### Figure 1
name_map <- data.frame(name = ageadj %>% pull(name) %>% unique(), new_name = c("Accidents", "Alzheimer's", "Assault", "Cerebrovascular\nDiseases", "Perinatal Period\nConditions", "Chronic Liver\nDisease and Cirrhosis", "Chronic Lower\nRespiratory Diseases", "Diabetes", "Heart Diease", "Hypertension", "HIV", "Influenza\nand Pneumonia", "Suicide", "Cancer", "Nephritis", "Parkinson's", "Pneumonitis due to\nSolids and Liquids", "Septicemia")) %>% as_tibble()
ageadj <- ageadj %>% left_join(name_map, by=c("name"="name")) %>% select(-name) %>% magrittr::set_colnames(c("year", "gender", "unadj_excess_num", "ageadj_excess", "name"))
## Panel A: overall excess age adjusted
overall_ageadj_changes %>% select(race, gender, year, change) %>% ggplot(aes(x=year, y=change, color=race)) + geom_line() + geom_point() + theme_minimal() + facet_wrap(~gender)
overall_ageadj_changes <- overall_ageadj_changes %>% mutate(plateau_F = ifelse(gender == "Female", ifelse(year > 2015, "Non-decline", "Decline"), "Decline")) %>% mutate(plateau_M = ifelse(gender == "Male", ifelse(year > 2011, "Non-decline", "Decline"), "Decline")) %>% mutate(plateau = ifelse(gender == "Male", plateau_M, plateau_F))
cpal <- c("#374e55", "#df8f44")
fig1a <- overall_ageadj_changes %>% ggplot(aes(x=year, y=excess_deaths_rate, shape=gender)) + geom_line(size = 0.75, color = "grey70") + geom_point(size = 3.25, aes(color = plateau)) + theme_minimal() + theme(panel.border = element_rect(color = "black", fill = "transparent")) + scale_y_continuous(breaks = seq(-100, 450, 50), labels = seq(-100, 450, 50), limits = c(-100, 450)) + geom_hline(yintercept = 0, linetype = "dashed", color = "grey70", linewidth = 0.65) + scale_x_continuous(breaks=seq(1999, 2020, 1), labels= function(x) ifelse(x %% 2 == 1, x, "")) + theme(axis.ticks = element_line(color = "black")) + ylab("Excess AAMR per\n100,000 Individuals") + xlab("Year") + theme(legend.title = element_blank(), legend.text = element_text(size = 12), axis.title = element_text(size = 12), axis.text = element_text(size = 9)) + ggtitle("Excess Age-Adjusted Mortality Rates") + theme(plot.title = element_text(hjust = 0.5, size = 15))  + theme(panel.grid = element_blank()) + geom_vline(xintercept = 2012, color = "grey80", linetype = "dashed", linewidth = 0.35) + geom_vline(xintercept = 2016, color = "grey80", linetype = "dashed", linewidth = 0.35) + scale_color_manual(values = c("Decline" = cpal[1], "Non-decline" = cpal[2]), labels = c("Decline" = "Decline", "Non-decline" = "Non-Decline"))
#may need to throw out 2020 becaue so high
fig1b <- overall_ageadj_changes %>% filter(gender == "Male") %>% mutate(color = ifelse(year <= 2011, "Decline", "Non-Decline")) %>% ggplot(aes(x = year, y = change, fill = color)) + geom_bar(stat = "identity") + theme_minimal() + scale_y_continuous(breaks = scales::pretty_breaks(n = 10)) + geom_hline(yintercept = 0, linetype = "dashed", color = "grey70", linewidth = 0.65) + scale_x_continuous(breaks=seq(2000, 2020, 1), labels= function(x) ifelse(x %% 2 == 0, x, "")) + theme(panel.border = element_rect(color = "black", fill = "transparent"), panel.grid.major.x = element_blank(), panel.grid.minor.y = element_blank()) + theme(axis.ticks = element_line(color = "black")) + ylab("Excess AAMR\nChange") + xlab("Year") + theme(legend.title = element_blank(), legend.text = element_text(size = 10)) + ggtitle("Yearly Excess AAMR Change for Males") + theme(plot.title = element_text(hjust = 0.5, size = 14)) + theme(panel.grid = element_blank()) + scale_fill_manual(values = c("Decline" = cpal[1], "Non-Decline" = cpal[2])) + theme(legend.title = element_blank(), legend.text = element_text(size = 12), axis.title = element_text(size = 12), axis.text = element_text(size = 9))
#copy of 1b but switch to female gender and year of decline is 2015
fig1c <- overall_ageadj_changes %>% filter(gender == "Female") %>% mutate(color = ifelse(year <= 2015, "Decline", "Non-Decline")) %>% ggplot(aes(x = year, y = change, fill = color)) + geom_bar(stat = "identity") + theme_minimal() + scale_y_continuous(breaks = scales::pretty_breaks(n = 10)) + geom_hline(yintercept = 0, linetype = "dashed", color = "grey70") + scale_x_continuous(breaks=seq(2000, 2020, 1), labels= function(x) ifelse(x %% 2 == 0, x, "")) + theme(panel.border = element_rect(color = "black", fill = "transparent"), panel.grid.major.x = element_blank(), panel.grid.minor.y = element_blank()) + theme(axis.ticks = element_line(color = "black")) + ylab("Excess AAMR\nChange") + xlab("Year")  + theme(legend.title = element_blank(), legend.text = element_text(size = 10)) + ggtitle("Yearly Excess AAMR Change for Females") + theme(plot.title = element_text(hjust = 0.5, size = 14)) + theme(plot.title = element_text(hjust = 0.5, size = 14)) + theme(panel.grid = element_blank()) + scale_fill_manual(values = c("Decline" = cpal[1], "Non-Decline" = cpal[2])) + theme(legend.title = element_blank(), legend.text = element_text(size = 12), axis.title = element_text(size = 12), axis.text = element_text(size = 9))
library(cowplot)
#top half of figure 1
right_half_fig1 <- cowplot::plot_grid(fig1b, fig1c, nrow = 2, ncol = 1, labels = c("B", "C"), label_size = 20)
top_half_fig1 <- plot_grid(fig1a, right_half_fig1, nrow = 1, labels = c("A", ""), label_size = 20)
#lineplot figure panels
order.of.conditions <- ageadj %>% group_by(name) %>% summarize(x = mean(ageadj_excess)) %>% arrange(desc(x)) %>% pull(name)
#copy for females and figure 1 done
#adds in the tail variabls
#ageadj <- rbind(ageadj %>% select(year, gender, ageadj_excess, name), ageadj %>% select(year, gender, ageadj_excess, name) %>% left_join(overall_ageadj_changes %>% select(gender, year, excess_deaths_rate), by=c("gender"="gender", "year"="year")) %>% group_by(year, gender) %>% summarize(nc = sum(ageadj_excess), t = unique(excess_deaths_rate)) %>% ungroup() %>% mutate(Tail = t - nc) %>% select(year, gender, Tail) %>% mutate(name = "Tail") %>% magrittr::set_colnames(c("year", "gender", "ageadj_excess", "name")))
m_ageadj_stack <- ageadj %>% filter(gender == "Male") %>% mutate(name = factor(name, levels = order.of.conditions)) %>% group_by(name) %>% group_split()
m_pltagestack <- lapply(m_ageadj_stack, function(astack) astack %>% filter(gender == "Male") %>% mutate(plateau = ifelse(year <= 2011, "Decline", "Non-Decline")) %>% ggplot(aes(x=year, y=ageadj_excess, color = plateau)) + geom_point(size = 3) + geom_line(size = 0.85, color = "grey65") + theme_minimal() + theme(legend.position = "none") + geom_vline(xintercept = 2012, linetype = "dashed", color = "grey70") + scale_x_continuous(breaks = c(2000, 2010, 2020), labels = c(2000, 2010, 2020)) + theme(axis.line.x = element_line(color = "black"), axis.line.y = element_line(color = "black")) + theme(axis.ticks = element_line(color = "black")) + ylab("Excess AAMR") + xlab("") + theme(panel.grid = element_blank()) + xlab("") + theme(axis.text = element_text(size = 10), axis.title = element_text(size = 10)) + ggtitle(unique(astack$name)) + theme(plot.title = element_text(hjust = 0.5, size = 14)) + scale_color_manual(values = c("Decline" = cpal[1], "Non-Decline" = cpal[2])) )
fig1d <- cowplot::plot_grid(plotlist = m_pltagestack, nrow = 6, ncol = 3)
f_ageadj_stack <- ageadj %>% filter(gender == "Female") %>% mutate(name = factor(name, levels = order.of.conditions)) %>% group_by(name) %>% group_split()
f_pltagestack <- lapply(f_ageadj_stack, function(astack) astack %>% filter(gender == "Female") %>% mutate(plateau = ifelse(year <= 2015, "Decline", "Non-Decline")) %>% ggplot(aes(x=year, y=ageadj_excess, color = plateau)) + geom_point(size = 3) + geom_line(size = 0.85, color = "grey65") + theme_minimal() + theme(legend.position = "none") + geom_vline(xintercept = 2016, linetype = "dashed", color = "grey70") + scale_x_continuous(breaks = c(2000, 2010, 2020), labels = c(2000, 2010, 2020)) + theme(axis.line.x = element_line(color = "black"), axis.line.y = element_line(color = "black")) + theme(axis.ticks = element_line(color = "black")) + ylab("Excess AAMR") + xlab("") + theme(panel.grid = element_blank()) + xlab("") + theme(axis.text = element_text(size = 10), axis.title = element_text(size = 10)) + ggtitle(unique(astack$name)) + theme(plot.title = element_text(hjust = 0.5, size = 14)) + scale_color_manual(values = c("Decline" = cpal[1], "Non-Decline" = cpal[2])) )
fig1e <- cowplot::plot_grid(plotlist = f_pltagestack, nrow = 6, ncol = 3)
fig1d_new <- plot_grid(ggplot() + theme_void() + ggtitle("Excess AAMR by Top Causes of Death for Males") + theme(plot.title = element_text(hjust = 0.5, size = 14)), fig1d, nrow = 2, rel_heights = c(0.02, 1))
fig1e_new <- plot_grid(ggplot() + theme_void() + ggtitle("Excess AAMR by Top Causes of Death for Females") + theme(plot.title = element_text(hjust = 0.5, size = 14)), fig1e, nrow = 2, rel_heights = c(0.02, 1))
bottom_half_fig1 <- plot_grid(fig1d_new, ggplot() + theme_void(), fig1e_new, nrow = 1, rel_widths = c(1, 0.1, 1), labels = c("D", "E"), label_size = 20)
plot_grid(top_half_fig1, bottom_half_fig1, nrow = 2, ncol = 1, rel_heights = c(0.3, 1)) %>% ggsave(filename = "~/Desktop/decline-fig1.pdf", plot = ., device = cairo_pdf, height = 20, width = 15, units = "in")
######## PLAYGROUND ########
mat <- df %>% select(year, gender, name, change) %>% filter(year > 1999)
#just look at for men, copy for women
#change is 2020 excess - 2019 excess; positive values means disparity got worse and negative values mean disparities got better, so rank 1 is assigned to the most negative (most driving the decline)
#I suppose instead of rank what I really want is
#some measure of what is contributing the most to the decline?
#so during the decline period
#what percent of the total change is made up by the change of each condition
#I think maybe all I need is the pre post split of the average with the confidence intervals
#I can use the rankings and other stuff in the text as I write
m_mat <- mat %>% filter(gender == "Male") %>% group_by(year) %>% mutate(rank = rank(change, ties.method = "first")) %>% ungroup()
#order rows by name
order.names.heatmap <- m_mat %>% filter(year < 2012) %>% group_by(name) %>% summarize(m = median(rank)) %>% arrange(desc(m)) %>% pull(name)
m_mat <- m_mat %>% mutate(name = factor(name, levels = order.names.heatmap))
m_mat %>% ggplot( aes(x = year, y = name, fill = rank)) +
geom_tile(color = "white") +  # Add tiles with white borders
geom_text(aes(label = rank), color = "black") +  # Add text labels
labs(title = "Heatmap of Conditions by Year",
x = "Year", y = "Condition") +
scale_fill_gradient(low = "black", high = "white") +
theme_minimal(base_size = 12) +  # Minimalist theme with adjusted base font size
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))  # Rotate x-axis text for better readability
scale_fill_manual(values = c("lightblue", "salmon"),
labels = c("1", "2"),
name = "Ordinal Value") +  # Custom colors and labels for the fill scale
#looking at change year over year
#i dont think this does a good job with showing the differences as I expect, but I can revisit this later
mat %>% filter(gender == "Male") %>% mutate(plateau = ifelse(year <= 2011, "Decline", "Non-decline")) %>% ggplot(aes(x=plateau, y=change)) + geom_boxplot() + facet_wrap(~name, scales = "free") + geom_jitter(width = 0.1)
######## END OF PLAYGROUND ############
### FIGURE 2
#average change figure
avg_change <- rbind(ageadj %>% select(year, gender, ageadj_excess, name), ageadj %>% select(year, gender, ageadj_excess, name) %>% left_join(overall_ageadj_changes %>% select(gender, year, excess_deaths_rate), by=c("gender"="gender", "year"="year")) %>% group_by(year, gender) %>% summarize(nc = sum(ageadj_excess), t = unique(excess_deaths_rate)) %>% ungroup() %>% mutate(Tail = t - nc) %>% select(year, gender, Tail) %>% mutate(name = "Tail") %>% magrittr::set_colnames(c("year", "gender", "ageadj_excess", "name")))
#avg_change %>% filter(gender == "Male") %>% group_by(name) %>% summarize(decline_rate = (ageadj_excess[year == 2014] - ageadj_excess[year == 1999]) / (2014 - 1999), plateau_rate = (ageadj_excess[year == 2020] - ageadj_excess[year == 2015]) / (2020 - 2015))
#remove 2020 because its obviously such a problem and just comment on it in the paper
avg_change %>% filter(gender == "Male") %>% group_by(name) %>% summarize(decline_rate = (ageadj_excess[year == 2011] - ageadj_excess[year == 1999]) / (2011 - 1999), plateau_rate = (ageadj_excess[year == 2019] - ageadj_excess[year == 2012]) / (2019 - 2012))
avg_change %>% filter(gender == "Female") %>% group_by(name) %>% summarize(decline_rate = (ageadj_excess[year == 2015] - ageadj_excess[year == 1999]) / (2015 - 1999), plateau_rate = (ageadj_excess[year == 2019] - ageadj_excess[year == 2016]) / (2019 - 2016))
#remove 2020 because its obviously such a problem and just comment on it in the paper
#fit a linear model so I can get confidence interval
get_lm_fits <- function(df){
slope <- coefficients(df %>% lm(ageadj_excess ~ year, .))[[2]]
ci <- (confint(df %>% lm(ageadj_excess ~ year, .), "year"))[1:2]
data.frame(slope = slope, lower = ci[1], upper = ci[2], gender = unique(df$gender), name = unique(df$name), plateau = unique(df$plateau))
}
m_avg_stack <- avg_change %>% filter(gender == "Male") %>% filter(year < 2020) %>% mutate(plateau = ifelse(year <= 2011, "Decline", "Non-decline")) %>% group_by(gender, plateau, name) %>% group_split()
m_avg_rate <- do.call(rbind, m_avg_stack %>% lapply(., function(df) get_lm_fits(df))) %>% as_tibble()
m_order.of.avg.names <- m_avg_rate %>% group_by(name) %>% summarize(diff = slope[plateau == "Decline"] - slope[plateau == "Non-decline"]) %>% arrange(diff) %>% pull(name) %>% rev()
m_avg_rate <- m_avg_rate %>% mutate(name = factor(name, levels = m_order.of.avg.names))
#bar plot version
#dot plot version
#avg_rate %>% ggplot( aes(x = name, y = slope, fill = plateau)) + geom_point(position = position_dodge(width = 0.5)) + labs(x = "Cause of Death", y = "Average Change in Excess AAMR", fill = "") +   geom_errorbar(aes(ymin = lower, ymax = upper), position = position_dodge(width = 0.5), width = 0.25) + theme_minimal()
f_avg_stack <- avg_change %>% filter(gender == "Female") %>% filter(year < 2020) %>% mutate(plateau = ifelse(year <= 2015, "Decline", "Non-decline")) %>% group_by(gender, plateau, name) %>% group_split()
f_avg_rate <- do.call(rbind, f_avg_stack %>% lapply(., function(df) get_lm_fits(df))) %>% as_tibble()
f_order.of.avg.names <- f_avg_rate %>% group_by(name) %>% summarize(diff = slope[plateau == "Decline"] - slope[plateau == "Non-decline"]) %>% arrange(diff) %>% pull(name) %>% rev()
f_avg_rate <- f_avg_rate %>% mutate(name = factor(name, levels = f_order.of.avg.names))
fig2a <- m_avg_rate  %>% ggplot( aes(y = name, x = slope, fill = plateau)) +
geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.75) +
labs(y = "", x = "Average Change in Excess AAMR", fill = "") +   geom_errorbar(aes(xmin = lower, xmax = upper), position = position_dodge(width = 0.8), width = 0.2, color = "grey60", size = 0.55) +
theme_minimal() + theme(panel.border = element_rect(color = "black", fill = "transparent"), panel.grid = element_blank()) + geom_vline(xintercept = 0, color = "grey30") + theme(panel.grid.major.y = element_line(color = "grey90", linetype = "dashed", linewidth = 0.5)) + scale_fill_manual(values = c("Decline" = cpal[1], "Non-decline" = cpal[2]), labels = c("Decline" = "Decline (1999-2011)", "Non-decline" = "Non-Decline (2012-2019)"), guide = guide_legend(nrow = 2)) + ggtitle("Males") + theme(plot.title = element_text(size = 14, hjust = 0.5)) + theme(legend.position = "bottom") + theme(axis.text = element_text(size = 12), axis.title = element_text(size = 14), legend.text = element_text(size = 12)) + xlim(-5, 5)
fig2b <- f_avg_rate %>% ggplot( aes(y = name, x = slope, fill = plateau)) +
geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.75) +
labs(y = "", x = "Average Change in Excess AAMR", fill = "") +   geom_errorbar(aes(xmin = lower, xmax = upper), position = position_dodge(width = 0.8), width = 0.2, color = "grey60", size = 0.55) +
theme_minimal() + theme(panel.border = element_rect(color = "black", fill = "transparent"), panel.grid = element_blank()) + geom_vline(xintercept = 0, color = "grey30") + theme(panel.grid.major.y = element_line(color = "grey90", linetype = "dashed", linewidth = 0.5)) + scale_fill_manual(values = c("Decline" = cpal[1], "Non-decline" = cpal[2]), labels = c("Decline" = "Decline (1999-2015)", "Non-decline" = "Non-Decline (2016-2019)"), guide = guide_legend(nrow = 2)) + ggtitle("Females") + theme(plot.title = element_text(size = 14, hjust = 0.5)) + theme(legend.position = "bottom") + theme(axis.text = element_text(size = 12), axis.title = element_text(size = 14), legend.text = element_text(size = 12)) + xlim(-5, 5)
fig2 <- plot_grid(fig2a, fig2b, nrow = 1, labels = c("A", "B"), label_size = 20)
fig2 %>% ggsave(filename = "~/Desktop/decline-fig2.pdf", plot = ., device = cairo_pdf, height = 10, width = 15, units = "in")
#
ageadj
ageadj %>% filter(year == 2020)
net_excess_ageadj
net_excess_ageadj %>% filter(year == 2020)
net_excess_ageadj %>% filter(gender == "Male") %>% mutate(bool = ifelse(excess_deaths_rate >= 395))
net_excess_ageadj %>% filter(gender == "Male") %>% mutate(bool = ifelse(excess_deaths_rate >= 395, TRUE, FALSE))
net_excess_ageadj %>% filter(gender == "Female") %>% mutate(bool = ifelse(excess_deaths_rate >= 192, TRUE, FALSE))
f_avg_rate
f_avg_rate %>% filter(str_contains("Influen", name))
f_avg_rate %>% filter(str_contains(name, "Influen"))
f_avg_rate %>% filter(str_detect(name, "Influen"))
new <- "~/Documents/GitHub/aa-mut-counter/results/count-matrix-Cys.txt"
old <- "~/Documents/GitHub/x2c/data/processed-data/Genomics_Output_Processed_specific_Cys.txt"
new <- read_table(new)
library(tidyverse)
new <- read_table(new)
old <- read_table(old)
new
old
identical(new, old)
new %>% pivot_longer(-Hugo_Symbol)
new %>% pivot_longer(-Hugo_Symbol) %>% magrittr::set_colnames(c("symbol", "name_new", value_new))
new %>% pivot_longer(-Hugo_Symbol) %>% magrittr::set_colnames(c("symbol", "name_new", "value_new"))
new <- new %>% pivot_longer(-Hugo_Symbol) %>% magrittr::set_colnames(c("symbol", "name_new", "value_new"))
old <- old %>% pivot_longer(-Hugo_Symbol) %>% magrittr::set_colnames(c("symbol", "name_old", "value_old"))
old
new
new <- new %>% mutate(idx = paste0(symbol, "-", name_new)) %>% select(idx, value_new)
old <- old %>% mutate(idx = paste0(symbol, "-", name_old)) %>% select(idx, value_old)
old
new
test <- left_join(old, new)
test
test %>% filter(is.na(value_old))
test %>% filter(is.na(value_new))
test %>% filter(is.na(value_new)) %>% pull(value_old) %>% sum()
test %>% filter(!is.na(value_new)) %>% pull(value_old) %>% sum()
224 / 329306
(224 / 329306) * 100
grep("*.-", "ACVR1Bp.Arg453Cys-All")
grep("*.", "ACVR1Bp.Arg453Cys-All")
grep(".*-", "ACVR1Bp.Arg453Cys-All")
grep("ACVR1Bp.Arg453Cys-All", ".*-",)
grep("ACVR1Bp.Arg453Cys-All", ".*-")
grep("*p", "ACVR1Bp.Arg453Cys-All")
grep(".*p", "ACVR1Bp.Arg453Cys-All")
grep("AC", "ACVR1Bp.Arg453Cys-All")
grepl("AC", "ACVR1Bp.Arg453Cys-All")
grep("AC", "ACVR1Bp.Arg453Cys-All")
str_extract("ACVR1Bp.Arg453Cys-All", "*p.")
str_extract("ACVR1Bp.Arg453Cys-All", "*.p")
str_extract("ACVR1Bp.Arg453Cys-All", ".p")
str_extract("ACVR1Bp.Arg453Cys-All", ".*p")
str_extract("ACVR1Bp.Arg453Cys-All", ".*p.")
str_extract("ACVR1Bp.Arg453Cys-All", ".*-")
str_extract("ACVR1Bp.Arg453Cys-All", ".*.-")
str_extract("ACVR1Bp.Arg453Cys-All", ".*-")
test %>% filter(!is.na(value_new)) %>% pull(idx) %>% str_extract("ACVR1Bp.Arg453Cys-All", ".*-")
test %>% filter(!is.na(value_new)) %>% pull(idx) %>% str_extract(., ".*-") %>% unique()
test %>% filter(!is.na(value_new)) %>% pull(idx) %>% str_extract(., ".*p.") %>% unique()
denominator <- "~/Documents/GitHub/x2c/data/processed-data/Genomics_Output_Processed.txt" %>% read_table() %>% filter(Hugo_Symbol == "Total")
denominator
test_denom <- "~/Documents/GitHub/aa-mut-counter/results/count-matrix-all.txt" %>% read_table() %>% filter(Hugo_Symbol == "Total")
test_denom
19181 / 19222
(1 - (19181 / 19222))*100
x <- "~/Downloads/Supplementary Software 1/Genomics_Analysis/interim_files/df_mutfiles.csv" %>% read_csv()
x
denominator
test_denom
test_denom %>% pivot_longer(-Hugo_Symbol)
test_denom %>% pivot_longer(-Hugo_Symbol) %>% mutate(idx = paste0(Hugo_Symbol, "-", name)) %>% select(idx, value) %>% magrittr::set_colnames(c("idx", "new_val"))
test_denom %>% pivot_longer(-Hugo_Symbol) %>% mutate(idx = paste0(Hugo_Symbol, "-", name)) %>% select(idx, value) %>% magrittr::set_colnames(c("idx", "new_val")) %>% left_join(., denominator %>% pivot_longer(-Hugo_Symbol) %>% mutate(idx = paste0(Hugo_Symbol, "-", name)) %>% select(idx, value) %>% magrittr::set_colnames(c("idx", "old_val")))
test_denom %>% pivot_longer(-Hugo_Symbol) %>% mutate(idx = paste0(Hugo_Symbol, "-", name)) %>% select(idx, value) %>% magrittr::set_colnames(c("idx", "new_val")) %>% left_join(., denominator %>% pivot_longer(-Hugo_Symbol) %>% mutate(idx = paste0(Hugo_Symbol, "-", name)) %>% select(idx, value) %>% magrittr::set_colnames(c("idx", "old_val"))) %>% mutate(diff = new_val - old_val)
test_denom %>% pivot_longer(-Hugo_Symbol) %>% mutate(idx = paste0(Hugo_Symbol, "-", name)) %>% select(idx, value) %>% magrittr::set_colnames(c("idx", "new_val")) %>% left_join(., denominator %>% pivot_longer(-Hugo_Symbol) %>% mutate(idx = paste0(Hugo_Symbol, "-", name)) %>% select(idx, value) %>% magrittr::set_colnames(c("idx", "old_val"))) %>% mutate(diff = new_val - old_val) %>% arrange(desc(diff))
test_denom %>% pivot_longer(-Hugo_Symbol) %>% mutate(idx = paste0(Hugo_Symbol, "-", name)) %>% select(idx, value) %>% magrittr::set_colnames(c("idx", "new_val")) %>% left_join(., denominator %>% pivot_longer(-Hugo_Symbol) %>% mutate(idx = paste0(Hugo_Symbol, "-", name)) %>% select(idx, value) %>% magrittr::set_colnames(c("idx", "old_val"))) %>% mutate(diff = new_val - old_val) %>% filter(diff != 0)
list_study_dirs_old=c('acbc_mskcc_2015','acc_tcga_pan_can_atlas_2018','acyc_mda_2015','acyc_mskcc_2013','acyc_sanger_2013','all_stjude_2013','all_stjude_2015','all_stjude_2016','aml_target_2018_pub','angs_project_painter_2018','bfn_duke_nus_2015','blca_bgi','blca_cornell_2016','blca_dfarber_mskcc_2014','blca_tcga_pub_2017','brca_bccrc','brca_broad','brca_igr_2015','brca_mbcproject_wagle_2017','brca_sanger','brca_tcga_pan_can_atlas_2018','ccrcc_irc_2014','ccrcc_utokyo_2013','cesc_tcga_pan_can_atlas_2018','chol_jhu_2013','chol_nccs_2013','chol_tcga_pan_can_atlas_2018','cll_iuopa_2015','cllsll_icgc_2011','coadread_dfci_2016','coadread_genentech','coadread_tcga_pan_can_atlas_2018','ctcl_columbia_2015','desm_broad_2015','dlbc_broad_2012','dlbc_tcga_pan_can_atlas_2018','dlbcl_dfci_2018','dlbcl_duke_2017','egc_tmucih_2015','es_dfarber_broad_2014','es_iocurie_2014','esca_tcga_pan_can_atlas_2018','escc_icgc','escc_ucla_2014','gbc_shanghai_2014','gbm_tcga_pan_can_atlas_2018','hcc_inserm_fr_2015','hnsc_broad','hnsc_jhu','hnsc_mdanderson_2013','hnsc_tcga_pan_can_atlas_2018','kich_tcga_pan_can_atlas_2018','kirc_bgi','kirc_tcga_pan_can_atlas_2018','kirp_tcga_pan_can_atlas_2018','laml_tcga_pan_can_atlas_2018','lcll_broad_2013','lgg_ucsf_2014','lgggbm_tcga_pub','lihc_amc_prv','lihc_riken','lihc_tcga_pan_can_atlas_2018','luad_broad','luad_mskcc_2015','luad_tcga_pan_can_atlas_2018','lusc_tcga_pan_can_atlas_2018','mbl_broad_2012','mbl_icgc','mbl_pcgp','mbl_sickkids_2016','mcl_idibips_2013','mds_tokyo_2011','mel_tsam_liang_2017','meso_tcga_pan_can_atlas_2018','mm_broad','mpnst_mskcc','mrt_bcgsc_2016','nbl_amc_2012','nbl_broad_2013','nbl_target_2018_pub','nbl_ucologne_2015','nccrcc_genentech_2014','nepc_wcm_2016','nhl_bcgsc_2011','nhl_bcgsc_2013','npc_nusingapore','nsclc_tcga_broad_2016','ov_tcga_pan_can_atlas_2018','paac_jhu_2014','paad_icgc','paad_qcmg_uq_2016','paad_tcga_pan_can_atlas_2018','paad_utsw_2015','panet_arcnet_2017','panet_jhu_2011','panet_shanghai_2013','past_dkfz_heidelberg_2013','pcnsl_mayo_2015','pcpg_tcga_pan_can_atlas_2018','plmeso_nyu_2015','prad_broad','prad_broad_2013','prad_cpcg_2017','prad_eururol_2017','prad_fhcrc','prad_mich','prad_p1000','prad_su2c_2015','prad_tcga_pan_can_atlas_2018','rms_nih_2014','rt_target_2018_pub','sarc_tcga_pan_can_atlas_2018','sclc_cancercell_gardner_2017','sclc_clcgp','sclc_jhu','sclc_ucologne_2015','skcm_broad','skcm_broad_brafresist_2012','skcm_broad_dfarber','skcm_tcga_pan_can_atlas_2018','mel_ucla_2016','skcm_yale','stad_pfizer_uhongkong','stad_tcga_pan_can_atlas_2018','stad_uhongkong','stad_utokyo','stes_tcga_pub','tet_nci_2014','tgct_tcga_pan_can_atlas_2018','thca_tcga_pan_can_atlas_2018','thym_tcga_pan_can_atlas_2018','uccc_nih_2017','ucec_tcga_pan_can_atlas_2018','ucs_jhu_2014','ucs_tcga_pan_can_atlas_2018','um_qimr_2016','uvm_tcga_pan_can_atlas_2018','vsc_cuk_2018','wt_target_2018_pub')
list_study_dirs_old=c('all_phase2_target_2018_pub', 'acbc_mskcc_2015','acc_tcga_pan_can_atlas_2018','acyc_mda_2015','acyc_mskcc_2013','acyc_sanger_2013','all_stjude_2013','all_stjude_2015','all_stjude_2016','aml_target_2018_pub','angs_project_painter_2018','bfn_duke_nus_2015','blca_bgi','blca_cornell_2016','blca_dfarber_mskcc_2014','blca_tcga_pub_2017','brca_bccrc','brca_broad','brca_igr_2015','brca_mbcproject_wagle_2017','brca_sanger','brca_tcga_pan_can_atlas_2018','ccrcc_irc_2014','ccrcc_utokyo_2013','cesc_tcga_pan_can_atlas_2018','chol_jhu_2013','chol_nccs_2013','chol_tcga_pan_can_atlas_2018','cll_iuopa_2015','cllsll_icgc_2011','coadread_dfci_2016','coadread_genentech','coadread_tcga_pan_can_atlas_2018','ctcl_columbia_2015','desm_broad_2015','dlbc_broad_2012','dlbc_tcga_pan_can_atlas_2018','dlbcl_dfci_2018','dlbcl_duke_2017','egc_tmucih_2015','es_dfarber_broad_2014','es_iocurie_2014','esca_tcga_pan_can_atlas_2018','escc_icgc','escc_ucla_2014','gbc_shanghai_2014','gbm_tcga_pan_can_atlas_2018','hcc_inserm_fr_2015','hnsc_broad','hnsc_jhu','hnsc_mdanderson_2013','hnsc_tcga_pan_can_atlas_2018','kich_tcga_pan_can_atlas_2018','kirc_bgi','kirc_tcga_pan_can_atlas_2018','kirp_tcga_pan_can_atlas_2018','laml_tcga_pan_can_atlas_2018','lcll_broad_2013','lgg_ucsf_2014','lgggbm_tcga_pub','lihc_amc_prv','lihc_riken','lihc_tcga_pan_can_atlas_2018','luad_broad','luad_mskcc_2015','luad_tcga_pan_can_atlas_2018','lusc_tcga_pan_can_atlas_2018','mbl_broad_2012','mbl_icgc','mbl_pcgp','mbl_sickkids_2016','mcl_idibips_2013','mds_tokyo_2011','mel_tsam_liang_2017','meso_tcga_pan_can_atlas_2018','mm_broad','mpnst_mskcc','mrt_bcgsc_2016','nbl_amc_2012','nbl_broad_2013','nbl_target_2018_pub','nbl_ucologne_2015','nccrcc_genentech_2014','nepc_wcm_2016','nhl_bcgsc_2011','nhl_bcgsc_2013','npc_nusingapore','nsclc_tcga_broad_2016','ov_tcga_pan_can_atlas_2018','paac_jhu_2014','paad_icgc','paad_qcmg_uq_2016','paad_tcga_pan_can_atlas_2018','paad_utsw_2015','panet_arcnet_2017','panet_jhu_2011','panet_shanghai_2013','past_dkfz_heidelberg_2013','pcnsl_mayo_2015','pcpg_tcga_pan_can_atlas_2018','plmeso_nyu_2015','prad_broad','prad_broad_2013','prad_cpcg_2017','prad_eururol_2017','prad_fhcrc','prad_mich','prad_p1000','prad_su2c_2015','prad_tcga_pan_can_atlas_2018','rms_nih_2014','rt_target_2018_pub','sarc_tcga_pan_can_atlas_2018','sclc_cancercell_gardner_2017','sclc_clcgp','sclc_jhu','sclc_ucologne_2015','skcm_broad','skcm_broad_brafresist_2012','skcm_broad_dfarber','skcm_tcga_pan_can_atlas_2018','mel_ucla_2016','skcm_yale','stad_pfizer_uhongkong','stad_tcga_pan_can_atlas_2018','stad_uhongkong','stad_utokyo','stes_tcga_pub','tet_nci_2014','tgct_tcga_pan_can_atlas_2018','thca_tcga_pan_can_atlas_2018','thym_tcga_pan_can_atlas_2018','uccc_nih_2017','ucec_tcga_pan_can_atlas_2018','ucs_jhu_2014','ucs_tcga_pan_can_atlas_2018','um_qimr_2016','uvm_tcga_pan_can_atlas_2018','vsc_cuk_2018','wt_target_2018_pub')
setdiff(list_study_dirs_old, list_study_dirs_new)
list_study_dirs_old=c('acbc_mskcc_2015','acc_tcga_pan_can_atlas_2018','acyc_mda_2015','acyc_mskcc_2013','acyc_sanger_2013','all_stjude_2013','all_stjude_2015','all_stjude_2016','aml_target_2018_pub','angs_project_painter_2018','bfn_duke_nus_2015','blca_bgi','blca_cornell_2016','blca_dfarber_mskcc_2014','blca_tcga_pub_2017','brca_bccrc','brca_broad','brca_igr_2015','brca_mbcproject_wagle_2017','brca_sanger','brca_tcga_pan_can_atlas_2018','ccrcc_irc_2014','ccrcc_utokyo_2013','cesc_tcga_pan_can_atlas_2018','chol_jhu_2013','chol_nccs_2013','chol_tcga_pan_can_atlas_2018','cll_iuopa_2015','cllsll_icgc_2011','coadread_dfci_2016','coadread_genentech','coadread_tcga_pan_can_atlas_2018','ctcl_columbia_2015','desm_broad_2015','dlbc_broad_2012','dlbc_tcga_pan_can_atlas_2018','dlbcl_dfci_2018','dlbcl_duke_2017','egc_tmucih_2015','es_dfarber_broad_2014','es_iocurie_2014','esca_tcga_pan_can_atlas_2018','escc_icgc','escc_ucla_2014','gbc_shanghai_2014','gbm_tcga_pan_can_atlas_2018','hcc_inserm_fr_2015','hnsc_broad','hnsc_jhu','hnsc_mdanderson_2013','hnsc_tcga_pan_can_atlas_2018','kich_tcga_pan_can_atlas_2018','kirc_bgi','kirc_tcga_pan_can_atlas_2018','kirp_tcga_pan_can_atlas_2018','laml_tcga_pan_can_atlas_2018','lcll_broad_2013','lgg_ucsf_2014','lgggbm_tcga_pub','lihc_amc_prv','lihc_riken','lihc_tcga_pan_can_atlas_2018','luad_broad','luad_mskcc_2015','luad_tcga_pan_can_atlas_2018','lusc_tcga_pan_can_atlas_2018','mbl_broad_2012','mbl_icgc','mbl_pcgp','mbl_sickkids_2016','mcl_idibips_2013','mds_tokyo_2011','mel_tsam_liang_2017','meso_tcga_pan_can_atlas_2018','mm_broad','mpnst_mskcc','mrt_bcgsc_2016','nbl_amc_2012','nbl_broad_2013','nbl_target_2018_pub','nbl_ucologne_2015','nccrcc_genentech_2014','nepc_wcm_2016','nhl_bcgsc_2011','nhl_bcgsc_2013','npc_nusingapore','nsclc_tcga_broad_2016','ov_tcga_pan_can_atlas_2018','paac_jhu_2014','paad_icgc','paad_qcmg_uq_2016','paad_tcga_pan_can_atlas_2018','paad_utsw_2015','panet_arcnet_2017','panet_jhu_2011','panet_shanghai_2013','past_dkfz_heidelberg_2013','pcnsl_mayo_2015','pcpg_tcga_pan_can_atlas_2018','plmeso_nyu_2015','prad_broad','prad_broad_2013','prad_cpcg_2017','prad_eururol_2017','prad_fhcrc','prad_mich','prad_p1000','prad_su2c_2015','prad_tcga_pan_can_atlas_2018','rms_nih_2014','rt_target_2018_pub','sarc_tcga_pan_can_atlas_2018','sclc_cancercell_gardner_2017','sclc_clcgp','sclc_jhu','sclc_ucologne_2015','skcm_broad','skcm_broad_brafresist_2012','skcm_broad_dfarber','skcm_tcga_pan_can_atlas_2018','mel_ucla_2016','skcm_yale','stad_pfizer_uhongkong','stad_tcga_pan_can_atlas_2018','stad_uhongkong','stad_utokyo','stes_tcga_pub','tet_nci_2014','tgct_tcga_pan_can_atlas_2018','thca_tcga_pan_can_atlas_2018','thym_tcga_pan_can_atlas_2018','uccc_nih_2017','ucec_tcga_pan_can_atlas_2018','ucs_jhu_2014','ucs_tcga_pan_can_atlas_2018','um_qimr_2016','uvm_tcga_pan_can_atlas_2018','vsc_cuk_2018','wt_target_2018_pub')
list_study_dirs_new=c('all_phase2_target_2018_pub', 'acbc_mskcc_2015','acc_tcga_pan_can_atlas_2018','acyc_mda_2015','acyc_mskcc_2013','acyc_sanger_2013','all_stjude_2013','all_stjude_2015','all_stjude_2016','aml_target_2018_pub','angs_project_painter_2018','bfn_duke_nus_2015','blca_bgi','blca_cornell_2016','blca_dfarber_mskcc_2014','blca_tcga_pub_2017','brca_bccrc','brca_broad','brca_igr_2015','brca_mbcproject_wagle_2017','brca_sanger','brca_tcga_pan_can_atlas_2018','ccrcc_irc_2014','ccrcc_utokyo_2013','cesc_tcga_pan_can_atlas_2018','chol_jhu_2013','chol_nccs_2013','chol_tcga_pan_can_atlas_2018','cll_iuopa_2015','cllsll_icgc_2011','coadread_dfci_2016','coadread_genentech','coadread_tcga_pan_can_atlas_2018','ctcl_columbia_2015','desm_broad_2015','dlbc_broad_2012','dlbc_tcga_pan_can_atlas_2018','dlbcl_dfci_2018','dlbcl_duke_2017','egc_tmucih_2015','es_dfarber_broad_2014','es_iocurie_2014','esca_tcga_pan_can_atlas_2018','escc_icgc','escc_ucla_2014','gbc_shanghai_2014','gbm_tcga_pan_can_atlas_2018','hcc_inserm_fr_2015','hnsc_broad','hnsc_jhu','hnsc_mdanderson_2013','hnsc_tcga_pan_can_atlas_2018','kich_tcga_pan_can_atlas_2018','kirc_bgi','kirc_tcga_pan_can_atlas_2018','kirp_tcga_pan_can_atlas_2018','laml_tcga_pan_can_atlas_2018','lcll_broad_2013','lgg_ucsf_2014','lgggbm_tcga_pub','lihc_amc_prv','lihc_riken','lihc_tcga_pan_can_atlas_2018','luad_broad','luad_mskcc_2015','luad_tcga_pan_can_atlas_2018','lusc_tcga_pan_can_atlas_2018','mbl_broad_2012','mbl_icgc','mbl_pcgp','mbl_sickkids_2016','mcl_idibips_2013','mds_tokyo_2011','mel_tsam_liang_2017','meso_tcga_pan_can_atlas_2018','mm_broad','mpnst_mskcc','mrt_bcgsc_2016','nbl_amc_2012','nbl_broad_2013','nbl_target_2018_pub','nbl_ucologne_2015','nccrcc_genentech_2014','nepc_wcm_2016','nhl_bcgsc_2011','nhl_bcgsc_2013','npc_nusingapore','nsclc_tcga_broad_2016','ov_tcga_pan_can_atlas_2018','paac_jhu_2014','paad_icgc','paad_qcmg_uq_2016','paad_tcga_pan_can_atlas_2018','paad_utsw_2015','panet_arcnet_2017','panet_jhu_2011','panet_shanghai_2013','past_dkfz_heidelberg_2013','pcnsl_mayo_2015','pcpg_tcga_pan_can_atlas_2018','plmeso_nyu_2015','prad_broad','prad_broad_2013','prad_cpcg_2017','prad_eururol_2017','prad_fhcrc','prad_mich','prad_p1000','prad_su2c_2015','prad_tcga_pan_can_atlas_2018','rms_nih_2014','rt_target_2018_pub','sarc_tcga_pan_can_atlas_2018','sclc_cancercell_gardner_2017','sclc_clcgp','sclc_jhu','sclc_ucologne_2015','skcm_broad','skcm_broad_brafresist_2012','skcm_broad_dfarber','skcm_tcga_pan_can_atlas_2018','mel_ucla_2016','skcm_yale','stad_pfizer_uhongkong','stad_tcga_pan_can_atlas_2018','stad_uhongkong','stad_utokyo','stes_tcga_pub','tet_nci_2014','tgct_tcga_pan_can_atlas_2018','thca_tcga_pan_can_atlas_2018','thym_tcga_pan_can_atlas_2018','uccc_nih_2017','ucec_tcga_pan_can_atlas_2018','ucs_jhu_2014','ucs_tcga_pan_can_atlas_2018','um_qimr_2016','uvm_tcga_pan_can_atlas_2018','vsc_cuk_2018','wt_target_2018_pub')
setdiff(list_study_dirs_old, list_study_dirs_new)
dirnew <- list_study_dirs_new
dirold <- list_study_dirs_old
length(dirnew)
length(dirold)
setdiff(dirnew, dirold)
setwd("~/Documents/GitHub/aa-mut-counter")
dirlist=c('all_phase2_target_2018_pub','acbc_mskcc_2015','acc_tcga_pan_can_atlas_2018','acyc_mda_2015','acyc_mskcc_2013','acyc_sanger_2013','all_stjude_2013','all_stjude_2015','all_stjude_2016','aml_target_2018_pub','angs_project_painter_2018','bfn_duke_nus_2015','blca_bgi','blca_cornell_2016','blca_dfarber_mskcc_2014','blca_tcga_pub_2017','brca_bccrc','brca_broad','brca_igr_2015','brca_mbcproject_wagle_2017','brca_sanger','brca_tcga_pan_can_atlas_2018','ccrcc_irc_2014','ccrcc_utokyo_2013','cesc_tcga_pan_can_atlas_2018','chol_jhu_2013','chol_nccs_2013','chol_tcga_pan_can_atlas_2018','cll_iuopa_2015','cllsll_icgc_2011','coadread_dfci_2016','coadread_genentech','coadread_tcga_pan_can_atlas_2018','ctcl_columbia_2015','desm_broad_2015','dlbc_broad_2012','dlbc_tcga_pan_can_atlas_2018','dlbcl_dfci_2018','dlbcl_duke_2017','egc_tmucih_2015','es_dfarber_broad_2014','es_iocurie_2014','esca_tcga_pan_can_atlas_2018','escc_icgc','escc_ucla_2014','gbc_shanghai_2014','gbm_tcga_pan_can_atlas_2018','hcc_inserm_fr_2015','hnsc_broad','hnsc_jhu','hnsc_mdanderson_2013','hnsc_tcga_pan_can_atlas_2018','kich_tcga_pan_can_atlas_2018','kirc_bgi','kirc_tcga_pan_can_atlas_2018','kirp_tcga_pan_can_atlas_2018','laml_tcga_pan_can_atlas_2018','lcll_broad_2013','lgg_ucsf_2014','lgggbm_tcga_pub','lihc_amc_prv','lihc_riken','lihc_tcga_pan_can_atlas_2018','luad_broad','luad_mskcc_2015','luad_tcga_pan_can_atlas_2018','lusc_tcga_pan_can_atlas_2018','mbl_broad_2012','mbl_icgc','mbl_pcgp','mbl_sickkids_2016','mcl_idibips_2013','mds_tokyo_2011','mel_tsam_liang_2017','meso_tcga_pan_can_atlas_2018','mm_broad','mpnst_mskcc','mrt_bcgsc_2016','nbl_amc_2012','nbl_broad_2013','nbl_target_2018_pub','nbl_ucologne_2015','nccrcc_genentech_2014','nepc_wcm_2016','nhl_bcgsc_2011','nhl_bcgsc_2013','npc_nusingapore','nsclc_tcga_broad_2016','ov_tcga_pan_can_atlas_2018','paac_jhu_2014','paad_icgc','paad_qcmg_uq_2016','paad_tcga_pan_can_atlas_2018','paad_utsw_2015','panet_arcnet_2017','panet_jhu_2011','panet_shanghai_2013','past_dkfz_heidelberg_2013','pcnsl_mayo_2015','pcpg_tcga_pan_can_atlas_2018','plmeso_nyu_2015','prad_broad','prad_broad_2013','prad_cpcg_2017','prad_eururol_2017','prad_fhcrc','prad_mich','prad_p1000','prad_su2c_2015','prad_tcga_pan_can_atlas_2018','rms_nih_2014','rt_target_2018_pub','sarc_tcga_pan_can_atlas_2018','sclc_cancercell_gardner_2017','sclc_clcgp','sclc_jhu','sclc_ucologne_2015','skcm_broad','skcm_broad_brafresist_2012','skcm_broad_dfarber','skcm_tcga_pan_can_atlas_2018','skcm_ucla_2016','skcm_yale','stad_pfizer_uhongkong','stad_tcga_pan_can_atlas_2018','stad_uhongkong','stad_utokyo','stes_tcga_pub','tet_nci_2014','tgct_tcga_pan_can_atlas_2018','thca_tcga_pan_can_atlas_2018','thym_tcga_pan_can_atlas_2018','uccc_nih_2017','ucec_tcga_pan_can_atlas_2018','ucs_jhu_2014','ucs_tcga_pan_can_atlas_2018','um_qimr_2016','uvm_tcga_pan_can_atlas_2018','vsc_cuk_2018','wt_target_2018_pub')
dirlist[1]
file.path("data", "clinical", dirlist[1])
file.path("data", "clinical", dirlist[1]) %>% list.files()
file.path("data", "clinical", "Prostrate") %>% list.files()
file.path("data", "clinical", "Prostrate") %>% list.files(pattern = "data_clinical_sample_v2.txt", recursive = TRUE)
file.path("data", "clinical", "Prostrate") %>% list.files(pattern = "data_clinical_sample_v2.txt", recursive = TRUE)[1] %>% read_csv()
file.path("data", "clinical", "Prostrate") %>% list.files(pattern = "data_clinical_sample_v2.txt", recursive = TRUE)[1] %>% read_table(sep = "\t")
file.path("data", "clinical", "Prostrate") %>% list.files(pattern = "data_clinical_sample_v2.txt", recursive = TRUE)[1] %>% read_table(delim = "\t")
file.path("data", "clinical", "Prostrate") %>% list.files(pattern = "data_clinical_sample_v2.txt", recursive = TRUE)[1] %>% read_table()
file.path("data", "clinical", "Prostrate") %>% list.files(pattern = "data_clinical_sample_v2.txt", recursive = TRUE)[1]
file.path("data", "clinical", "Prostrate") %>% list.files(pattern = "data_clinical_sample_v2.txt", recursive = TRUE) %>% pull(1)
(file.path("data", "clinical", "Prostrate") %>% list.files(pattern = "data_clinical_sample_v2.txt", recursive = TRUE))[1]
(file.path("data", "clinical", "Prostrate") %>% list.files(pattern = "data_clinical_sample_v2.txt", recursive = TRUE))[1] %>% read_table(delim = "\t")
(file.path("data", "clinical", "Prostrate") %>% list.files(pattern = "data_clinical_sample_v2.txt", recursive = TRUE))[1] %>% read_table(sep = "\t")
(file.path("data", "clinical", "Prostrate") %>% list.files(pattern = "data_clinical_sample_v2.txt", recursive = TRUE))[1] %>% read_table()
(file.path("data", "clinical", "Prostrate") %>% list.files(pattern = "data_clinical_sample_v2.txt", recursive = TRUE, full.names = TRUE))[1] %>% read_table()
(file.path("data", "clinical", "Skin") %>% list.files(pattern = "data_clinical_sample_v2.txt", recursive = TRUE))
(file.path("data", "clinical", "Skin") %>% list.files(pattern = "data_clinical_sample_v2.txt", recursive = TRUE))[7] %>% read_table()
(file.path("data", "clinical", "Skin") %>% list.files(pattern = "data_clinical_sample_v2.txt", recursive = TRUE))
(file.path("data", "clinical", "Skin") %>% list.files(pattern = "data_clinical_sample_v2.txt", recursive = TRUE))[7]
(file.path("data", "clinical", "Skin") %>% list.files(pattern = "data_clinical_sample_v2.txt", recursive = TRUE, full.names = TRUE))[7] %>% read_table()
(file.path("data", "clinical", "Skin") %>% list.files(pattern = "data_clinical_sample_v2.txt", recursive = TRUE, full.names = TRUE))[7] %>% read_table() %>% pull(CODE)
(file.path("data", "clinical", "Skin") %>% list.files(pattern = "data_clinical_sample_v2.txt", recursive = TRUE, full.names = TRUE))[7] %>% read_table() %>% pull(CANCER_TYPE_DETAILED)
(file.path("data", "clinical", "Prostrate") %>% list.files(pattern = "data_clinical_sample_v2.txt", recursive = TRUE))[1] %>% read_table()
(file.path("data", "clinical", "Prostrate") %>% list.files(pattern = "data_clinical_sample_v2.txt", recursive = TRUE, full.names = TRUE))[1] %>% read_table()
(file.path("~/Downloads/Supplementary Software 1/Genomics_Analysis/clinical", "Prostrate") %>% list.files(pattern = "data_clinical_sample_v2.txt", recursive = TRUE, full.names = TRUE))[1] %>% read_table()
(file.path("data", "clinical", "Prostrate") %>% list.files(pattern = "data_clinical_sample_v2.txt", recursive = TRUE, full.names = TRUE))[1] %>% read_table()
old <- (file.path("~/Downloads/Supplementary Software 1/Genomics_Analysis/clinical", "Prostrate") %>% list.files(pattern = "data_clinical_sample_v2.txt", recursive = TRUE, full.names = TRUE))[1] %>% read_table()
new <- (file.path("data", "clinical", "Prostrate") %>% list.files(pattern = "data_clinical_sample_v2.txt", recursive = TRUE, full.names = TRUE))[1] %>% read_table()
old
new
identical(old, new)
row_diffs <- which(apply(old, 1, function(x) !identical(x, new[which(rownames(new) == rownames(x)),])))
row_diffs
rownames(old)
new[1,]
old[1,]
identical(new[1,], old[1,])
lapply(1:114, function(x) identical(new[x,], old[x,])) %>% unlist()
lapply(1:114, function(x) identical(new[x,], old[x,])) %>% unlist() %>% sum()
lapply(1:nrow(new), function(x) identical(new[x,], old[x,])) %>% unlist() %>% sum()
nrow(old) - lapply(1:nrow(new), function(x) identical(new[x,], old[x,])) %>% unlist() %>% sum()
(file.path("data", "clinical", "Prostrate") %>% list.files(pattern = "data_clinical_sample_v2.txt", recursive = TRUE, full.names = TRUE)) %>% length()
(file.path("data", "clinical", "Prostrate") %>% list.files(pattern = "data_clinical_sample_v2.txt", recursive = TRUE, full.names = TRUE))
for (t in 1:10){
old <- (file.path("~/Downloads/Supplementary Software 1/Genomics_Analysis/clinical", "Prostrate") %>% list.files(pattern = "data_clinical_sample_v2.txt", recursive = TRUE, full.names = TRUE))[t] %>% read_table()
new <- (file.path("data", "clinical", "Prostrate") %>% list.files(pattern = "data_clinical_sample_v2.txt", recursive = TRUE, full.names = TRUE))[t] %>% read_table()
nrow(old) - lapply(1:nrow(new), function(x) identical(new[x,], old[x,])) %>% unlist() %>% sum()
}
l <- c()
for (t in 1:10){
old <- (file.path("~/Downloads/Supplementary Software 1/Genomics_Analysis/clinical", "Prostrate") %>% list.files(pattern = "data_clinical_sample_v2.txt", recursive = TRUE, full.names = TRUE))[t] %>% read_table()
new <- (file.path("data", "clinical", "Prostrate") %>% list.files(pattern = "data_clinical_sample_v2.txt", recursive = TRUE, full.names = TRUE))[t] %>% read_table()
tmp <- nrow(old) - lapply(1:nrow(new), function(x) identical(new[x,], old[x,])) %>% unlist() %>% sum()
l <- c(l, tmp)
}
l
all_old <- "~/Downloads/Supplementary Software 1/Genomics_Analysis/interim_files/df_mutfiles.csv" %>% read_csv() %>% filter(Hugo_Symbol == "Total")
all_old <- "~/Downloads/Supplementary Software 1/Genomics_Analysis/interim_files/df_mutfiles.csv" %>% read_csv()
all_old
denominator
all_new <- "results/count-matrix-all.txt" %>% read_table() %>% filter(Hugo_Symbol == "Total")
all_new
all_new %>% pivot_longer(-Hugo_Symbol) %>% mutate(idx = paste0(Hugo_Symbol, "-", name)) %>% select(idx, value) %>% magrittr::set_colnames(c("idx", "new_val")) %>% left_join(., denominator %>% pivot_longer(-Hugo_Symbol) %>% mutate(idx = paste0(Hugo_Symbol, "-", name)) %>% select(idx, value) %>% magrittr::set_colnames(c("idx", "old_val"))) %>% mutate(diff = new_val - old_val) %>% arrange(desc(diff))
all_new %>% pivot_longer(-Hugo_Symbol) %>% mutate(idx = paste0(Hugo_Symbol, "-", name)) %>% select(idx, value) %>% magrittr::set_colnames(c("idx", "new_val")) %>% left_join(., denominator %>% pivot_longer(-Hugo_Symbol) %>% mutate(idx = paste0(Hugo_Symbol, "-", name)) %>% select(idx, value) %>% magrittr::set_colnames(c("idx", "old_val"))) %>% mutate(diff = new_val - old_val) %>% filter(diff != 0)
all_new
new <- "results/count-matrix-all.txt" %>% read_table()
old <- "~/Documents/GitHub/x2c/data/processed-data/Genomics_Output_Processed.txt" %>% read_table()
new
old
all_new
new %>% select(Hugo_Symbol, All, `70327`)
x <- new %>% select(Hugo_Symbol, All, `70327`)
y <- old %>% select(Hugo_Symbol, All, `70327`)
x
y
y %>% filter(Hugo_Symbol %in% c("A1CF"))
y %>% filter(str_contains("A1CF", Hugo_Symbol))
y %>% filter(stringr::str_contains("A1CF", Hugo_Symbol))
y %>% filter(str_detect("A1CF", Hugo_Symbol))
x %>% filter(str_detect("A1CF", Hugo_Symbol))
x %>% filter(grepl("A1CF", Hugo_Symbol))
x %>% filter(grepl("A1CF", Hugo_Symbol)) %>% pull(3) %>% sum
x %>% filter(grepl("A1CF", Hugo_Symbol)) %>% pull(3) %>% sum()
old
y
x
x %>% filter(grepl("DEC", Hugo_Symbol)) %>% pull(3) %>% sum()
x %>% filter(grepl("DEC", Hugo_Symbol))
%>% filter(grepl("DEC", Hugo_Symbol))
y%>% filter(grepl("DEC", Hugo_Symbol))
y %>% filter(grepl("DEC1", Hugo_Symbol))
x %>% filter(grepl("DEC", Hugo_Symbol)) %>% mutate(t = str_extract("*.p", Hugo_Symbol))
x %>% filter(grepl("DEC", Hugo_Symbol)) %>% mutate(t = grep("*.p", Hugo_Symbol))
x %>% filter(grepl("DEC", Hugo_Symbol)) %>% mutate(t = sub("p\\..*$", "", Hugo_Symbol))
x %>% filter(grepl("DEC", Hugo_Symbol)) %>% mutate(t = sub("p\\..*$", "", Hugo_Symbol)) %>% group_by(t) %>% summarize(n = sum(`70327`))
y %>% filter(grepl("DEC", Hugo_Symbol))
x_gene <- x %>% select(1,3) %>% mutate(t = sub("p\\..*$", "", Hugo_Symbol)) %>% group_by(t) %>% summarize(n = sum(`70327`))
x_Gene
x_Gene
x_gene
y
y %>% filter(grepl("SEP", Hugo_Symbol))
x_gene %>% filter(grepl("SEP", Hugo_Symbol))
x_gene %>% filter(grepl("SEP", t))
x_gene %>% filter(grepl("SEP", t)) %>% as.data.frame()
y %>% filter(grepl("SEP", Hugo_Symbol))
x_gene$n %>% sum()
x_gene
ground <- "~/Downloads/Supplementary Software 1/Genomics_Analysis/interim_files/df_mutfiles.csv" %>% read_csv()
ground
ground <- "~/Downloads/Supplementary Software 1/Genomics_Analysis/interim_files/df_mutfiles.csv" %>% read_tsv()
ground
old <- "~/Documents/GitHub/x2c/data/processed-data/Genomics_Output_Processed.txt" %>% read_table()
R.version()
version()
R.version
